<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‚˜ì¸ë¸”ë¡œì»¤ìŠ¤ ë¦¬ê·¸ - 2026ë…„ 1ì›” ì‹œì¦Œ</title>
  <style>
    /* ===== Design Tokens ===== */
    :root {
      /* Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;

      /* Typography */
      --font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-md: 1rem;
      --font-size-lg: 1.25rem;
      --font-size-xl: 1.5rem;
      --font-size-2xl: 2rem;

      /* Border Radius */
      --radius-sm: 12px;
      --radius-md: 20px;
      --radius-lg: 28px;
      --radius-full: 9999px;

      /* Transitions */
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);

      /* Team Colors */
      --team-a: #3b82f6;
      --team-b: #22c55e;
      --team-c: #f59e0b;
    }

    /* ===== Dark Theme ===== */
    [data-theme="dark"] {
      --bg-base: transparent;
      --bg-gradient-start: rgba(0, 0, 0, 0.6);
      --bg-gradient-end: rgba(0, 0, 0, 0.75);
      --bg-mesh-1: rgba(80, 80, 120, 0.1);
      --bg-mesh-2: rgba(100, 60, 140, 0.08);
      --bg-mesh-3: rgba(60, 100, 140, 0.06);

      --glass-bg: rgba(20, 20, 25, 0.6);
      --glass-bg-hover: rgba(30, 30, 35, 0.7);
      --glass-border: rgba(255, 255, 255, 0.15);
      --glass-border-hover: rgba(255, 255, 255, 0.25);
      --glass-shadow: rgba(0, 0, 0, 0.5);
      --glass-highlight: rgba(255, 255, 255, 0.08);
      --glass-shine: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 40%);

      /* Button/Filter glass */
      --btn-glass-bg: rgba(255, 255, 255, 0.03);
      --btn-glass-border: rgba(255, 255, 255, 0.1);

      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.45);

      --accent: #ff6b35;
      --accent-hover: #ff8555;
      --accent-glow: rgba(255, 107, 53, 0.5);

      --medal-gold: #ffd700;
      --medal-silver: #c0c0c0;
      --medal-bronze: #cd7f32;

      /* Dark theme team badge colors */
      --team-a-bg: rgba(255, 255, 255, 0.04);
      --team-b-bg: rgba(255, 255, 255, 0.04);
      --team-c-bg: rgba(255, 255, 255, 0.04);
      --team-a: #60a5fa;
      --team-b: #4ade80;
      --team-c: #fbbf24;

      /* Active filter glass */
      --active-glass-bg: rgba(255, 107, 53, 0.12);
      --active-glass-border: rgba(255, 107, 53, 0.25);

      --border: rgba(255, 255, 255, 0.1);
      --bg-hover: rgba(255, 255, 255, 0.05);
    }

    /* ===== Light Theme ===== */
    [data-theme="light"] {
      --bg-base: transparent;
      --bg-gradient-start: rgba(245, 245, 250, 0.7);
      --bg-gradient-end: rgba(235, 235, 245, 0.8);
      --bg-mesh-1: rgba(59, 130, 246, 0.1);
      --bg-mesh-2: rgba(139, 92, 246, 0.08);
      --bg-mesh-3: rgba(236, 72, 153, 0.05);

      --glass-bg: rgba(255, 255, 255, 0.6);
      --glass-bg-hover: rgba(255, 255, 255, 0.75);
      --glass-border: rgba(255, 255, 255, 0.8);
      --glass-border-hover: rgba(255, 255, 255, 0.95);
      --glass-shadow: rgba(0, 0, 0, 0.08);
      --glass-highlight: rgba(255, 255, 255, 0.95);
      --glass-shine: linear-gradient(135deg, rgba(255,255,255,0.7) 0%, transparent 50%);

      /* Button/Filter glass */
      --btn-glass-bg: rgba(255, 255, 255, 0.5);
      --btn-glass-border: rgba(255, 255, 255, 0.7);

      --text-primary: rgba(0, 0, 0, 0.88);
      --text-secondary: rgba(0, 0, 0, 0.55);
      --text-muted: rgba(0, 0, 0, 0.35);

      --accent: #e55a2b;
      --accent-hover: #d04a1b;
      --accent-glow: rgba(229, 90, 43, 0.3);

      --medal-gold: #d4a800;
      --medal-silver: #8a8a8a;
      --medal-bronze: #a56324;

      /* Light theme team badge colors */
      --team-a-bg: rgba(59, 130, 246, 0.15);
      --team-b-bg: rgba(34, 197, 94, 0.15);
      --team-c-bg: rgba(245, 158, 11, 0.15);
      --team-a: #2563eb;
      --team-b: #16a34a;
      --team-c: #d97706;

      /* Active filter glass */
      --active-glass-bg: rgba(229, 90, 43, 0.15);
      --active-glass-border: rgba(229, 90, 43, 0.4);

      --border: rgba(0, 0, 0, 0.1);
      --bg-hover: rgba(0, 0, 0, 0.03);
    }

    /* ===== Base Styles ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-family);
      background: transparent;
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      transition: color var(--transition-slow);
    }

    /* ===== Background Image ===== */
    .bg-image {
      position: fixed;
      inset: 0;
      z-index: -2;
      background-image: url('https://images.unsplash.com/photo-1546519638-68e109498ffc?q=80&w=2090&auto=format&fit=crop');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* ===== Animated Background Overlay ===== */
    .bg-mesh {
      position: fixed;
      inset: 0;
      z-index: -1;
      background:
        radial-gradient(ellipse 80% 50% at 20% 30%, var(--bg-mesh-1), transparent),
        radial-gradient(ellipse 60% 60% at 80% 20%, var(--bg-mesh-2), transparent),
        radial-gradient(ellipse 50% 40% at 50% 80%, var(--bg-mesh-3), transparent),
        linear-gradient(180deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      transition: all var(--transition-slow);
    }

    /* ===== Liquid Glass Classes ===== */
    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      box-shadow:
        0 8px 32px var(--glass-shadow),
        inset 0 1px 0 var(--glass-highlight),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
      transition: all var(--transition-normal);
    }

    .glass::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at 20% 20%, var(--glass-highlight), transparent 60%);
      pointer-events: none;
      border-radius: inherit;
      opacity: 0.8;
    }

    .glass::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      pointer-events: none;
    }

    .glass:hover:not(header):not(.table-wrapper) {
      background: var(--glass-bg-hover);
      border-color: var(--glass-border-hover);
      transform: translateY(-2px);
      box-shadow:
        0 12px 40px var(--glass-shadow),
        inset 0 1px 0 var(--glass-highlight);
    }

    /* Header - no hover effect */
    header.glass:hover {
      background: var(--glass-bg);
      border-color: var(--glass-border);
      transform: none;
      box-shadow:
        0 8px 32px var(--glass-shadow),
        inset 0 1px 0 var(--glass-highlight);
    }

    /* ===== Container ===== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--space-lg);
      position: relative;
      z-index: 1;
    }

    /* ===== Theme Toggle ===== */
    .theme-toggle {
      position: fixed;
      top: var(--space-lg);
      right: var(--space-lg);
      z-index: 100;
    }

    .theme-btn {
      width: 48px;
      height: 48px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-full);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-primary);
      transition: all var(--transition-normal);
      box-shadow: 0 4px 16px var(--glass-shadow);
    }

    .theme-btn:hover {
      transform: scale(1.1) rotate(15deg);
      background: var(--glass-bg-hover);
    }

    .theme-btn svg {
      width: 24px;
      height: 24px;
      transition: transform var(--transition-normal);
    }

    .sun-icon { display: none; }
    .moon-icon { display: block; }

    [data-theme="light"] .sun-icon { display: block; }
    [data-theme="light"] .moon-icon { display: none; }

    /* ===== Header ===== */
    header {
      text-align: center;
      margin-bottom: var(--space-xl);
      padding: var(--space-2xl) var(--space-lg);
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    header h1 {
      font-size: var(--font-size-2xl);
      font-weight: 700;
      margin-bottom: var(--space-sm);
      background: linear-gradient(135deg, var(--accent) 0%, #ffd700 50%, #4a9eff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 200% auto;
      animation: gradient-shift 5s ease infinite;
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% center; }
      50% { background-position: 100% center; }
    }

    header p {
      color: var(--text-secondary);
      font-size: var(--font-size-lg);
    }

    /* Stats Summary Pills */
    .stats-summary {
      display: flex;
      justify-content: center;
      gap: var(--space-lg);
      margin-top: var(--space-xl);
      flex-wrap: wrap;
    }

    .stat-item {
      padding: var(--space-md) var(--space-lg);
      text-align: center;
      min-width: 100px;
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
      box-shadow: 0 2px 8px var(--glass-shadow);
    }

    .stat-value {
      font-size: var(--font-size-xl);
      font-weight: 700;
      color: var(--accent);
      text-shadow: 0 0 20px var(--accent-glow);
    }

    .stat-label {
      font-size: var(--font-size-xs);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-top: var(--space-xs);
    }

    /* ===== Controls ===== */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
      align-items: center;
    }

    /* Season Toggle - Segmented Control */
    .toggle-group {
      display: flex;
      padding: var(--space-xs);
      gap: var(--space-xs);
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
    }

    .toggle-btn {
      padding: var(--space-sm) var(--space-md);
      background: transparent;
      border: 1px solid transparent;
      color: var(--text-secondary);
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all var(--transition-normal);
      position: relative;
    }

    .toggle-btn.active {
      background: var(--active-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--active-glass-border);
      color: var(--accent);
      box-shadow: 0 2px 12px var(--accent-glow);
    }

    .toggle-btn:hover:not(.active) {
      background: var(--glass-bg-hover);
      border-color: var(--glass-border-hover);
      color: var(--text-primary);
    }

    /* Search Box */
    .search-box {
      position: relative;
      flex: 1;
      min-width: 280px;
    }

    .search-box input {
      width: 100%;
      padding: var(--space-md) var(--space-md) var(--space-md) 48px;
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: var(--font-size-md);
      transition: all var(--transition-normal);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-glow);
      background: var(--glass-bg-hover);
    }

    .search-box input::placeholder {
      color: var(--text-muted);
    }

    .search-box svg {
      position: absolute;
      left: var(--space-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
    }

    /* ===== Table ===== */
    .table-wrapper {
      overflow: hidden;
      margin-bottom: 100px;
    }

    .table-scroll {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 900px;
    }

    th, td {
      padding: var(--space-md);
      text-align: center;
      white-space: nowrap;
    }

    thead {
      position: relative;
      z-index: 10;
    }

    /* ê³ ì • í—¤ë” ìƒë‹¨ ì˜¤ë²„ë ˆì´ */
    .fixed-header-overlay {
      position: fixed;
      top: 0;
      z-index: 99;
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      display: none;
    }

    /* ê³ ì • í—¤ë” ìŠ¤íƒ€ì¼ */
    .fixed-header {
      position: fixed;
      top: 0;
      z-index: 100;
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-bottom: none;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      box-shadow: 0 8px 32px var(--glass-shadow);
      overflow: hidden;
    }

    .fixed-header table {
      margin: 0;
    }

    .fixed-header th {
      background: transparent;
    }

    thead tr {
      background: transparent;
    }

    th {
      background: transparent;
      font-weight: 600;
      font-size: var(--font-size-xs);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      border-bottom: none;
      transition: all var(--transition-normal);
      padding: var(--space-lg) var(--space-sm) var(--space-md);
      position: relative;
    }

    th::before {
      content: '';
      position: absolute;
      top: var(--space-md);
      bottom: 6px;
      left: 2px;
      right: 2px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      z-index: -1;
      transition: all var(--transition-normal);
    }

    th[data-sort] {
      cursor: pointer;
      user-select: none;
    }

    th[data-sort]:hover::before {
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border-color: var(--btn-glass-border);
      box-shadow:
        0 2px 8px var(--glass-shadow),
        inset 0 1px 0 var(--glass-highlight);
    }

    th[data-sort]:hover {
      color: var(--text-primary);
    }

    th.sorted {
      color: var(--accent);
    }

    th.sorted::before {
      background: var(--active-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border-color: var(--active-glass-border);
      box-shadow:
        0 2px 10px var(--accent-glow),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }

    th .sort-icon {
      display: inline-block;
      margin-left: var(--space-xs);
      opacity: 0.5;
      transition: all var(--transition-fast);
    }

    th.sorted .sort-icon {
      opacity: 1;
    }

    th.sorted.desc .sort-icon {
      transform: rotate(180deg);
    }

    td {
      background: transparent;
      border-bottom: 1px solid var(--glass-border);
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
    }

    tbody tr {
      transition: all var(--transition-fast);
    }

    tbody tr:hover td {
      background: var(--glass-bg-hover);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    .player-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Team Badge - Glass Pill */
    .team-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--font-size-xs);
      font-weight: 600;
      backdrop-filter: blur(8px) saturate(140%);
      -webkit-backdrop-filter: blur(8px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
    }

    .team-A {
      background: var(--team-a-bg);
      color: var(--team-a);
    }
    .team-B {
      background: var(--team-b-bg);
      color: var(--team-b);
    }
    .team-C {
      background: var(--team-c-bg);
      color: var(--team-c);
    }

    .highlight {
      color: var(--accent);
      font-weight: 600;
    }

    /* Rank Medals */
    .rank {
      font-weight: 700;
      color: var(--text-secondary);
    }

    .rank-1 {
      color: var(--medal-gold);
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    .rank-2 {
      color: var(--medal-silver);
      text-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
    }
    .rank-3 {
      color: var(--medal-bronze);
      text-shadow: 0 0 10px rgba(205, 127, 50, 0.5);
    }

    /* ===== Chat FAB ===== */
    .chat-fab {
      position: fixed;
      bottom: var(--space-lg);
      right: var(--space-lg);
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      cursor: pointer;
      box-shadow:
        0 8px 32px var(--accent-glow),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transition: all var(--transition-normal);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse-glow 3s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 8px 32px var(--accent-glow); }
      50% { box-shadow: 0 8px 48px var(--accent-glow), 0 0 60px var(--accent-glow); }
    }

    .chat-fab:hover {
      transform: scale(1.1);
      animation: none;
      box-shadow: 0 12px 48px var(--accent-glow);
    }

    .chat-fab svg {
      color: white;
      width: 28px;
      height: 28px;
    }

    /* ===== Chat Modal ===== */
    .chat-modal {
      position: fixed;
      bottom: 100px;
      right: var(--space-lg);
      width: 420px;
      max-width: calc(100vw - 48px);
      height: 550px;
      max-height: calc(100vh - 150px);
      display: none;
      flex-direction: column;
      z-index: 1001;
      overflow: hidden;
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      box-shadow: 0 16px 48px var(--glass-shadow);
    }

    .chat-modal.open {
      display: flex;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .chat-header {
      padding: var(--space-md) var(--space-lg);
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header h3 {
      font-size: var(--font-size-md);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .chat-header h3 svg {
      color: var(--accent);
    }

    .close-btn {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: var(--text-secondary);
      cursor: pointer;
      padding: var(--space-sm);
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-btn:hover {
      background: var(--glass-bg-hover);
      color: var(--text-primary);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-md);
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .message {
      max-width: 90%;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      line-height: 1.5;
      word-break: break-word;
      overflow-wrap: break-word;
    }

    .message.user {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      color: white;
      border-bottom-right-radius: var(--space-xs);
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    .message.ai {
      align-self: flex-start;
      background: var(--glass-bg-hover);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      color: var(--text-primary);
      border-bottom-left-radius: var(--space-xs);
    }

    /* AI ë©”ì‹œì§€ ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
    .message.ai p {
      margin: 0 0 8px 0;
    }

    .message.ai p:last-child {
      margin-bottom: 0;
    }

    .message.ai strong {
      color: var(--accent);
      font-weight: 600;
    }

    .message.ai ul, .message.ai ol {
      margin: 8px 0;
      padding-left: 20px;
    }

    .message.ai li {
      margin: 4px 0;
    }

    .message.ai .table-wrapper {
      overflow-x: auto;
      margin: 12px 0;
      border-radius: 8px;
      -webkit-overflow-scrolling: touch;
    }

    .message.ai table {
      width: 100%;
      min-width: 100%;
      border-collapse: collapse;
      font-size: var(--font-size-xs);
      white-space: nowrap;
    }

    .message.ai th, .message.ai td {
      padding: var(--space-xs) var(--space-sm);
      text-align: left;
      border: 1px solid var(--glass-border);
    }

    .message.ai th {
      background: var(--glass-bg);
      font-weight: 600;
      color: var(--accent);
      font-size: var(--font-size-xs);
    }

    .message.ai td:first-child {
      font-weight: 600;
      color: var(--text-secondary);
    }

    .message.ai tr:hover td {
      background: rgba(255, 107, 53, 0.05);
    }

    /* í…Œì´ë¸” ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    .message.ai .table-wrapper::-webkit-scrollbar {
      height: 4px;
    }

    .message.ai .table-wrapper::-webkit-scrollbar-track {
      background: var(--bg-hover);
      border-radius: 2px;
    }

    .message.ai .table-wrapper::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 2px;
    }

    /* ëª¨ë°”ì¼ì—ì„œ í…Œì´ë¸” ìµœì í™” */
    @media (max-width: 480px) {
      .message.ai table {
        font-size: 0.72rem;
      }

      .message.ai th, .message.ai td {
        padding: 4px 5px;
      }

      .message.ai th {
        font-size: 0.7rem;
      }
    }

    .message.ai h3, .message.ai h4 {
      margin: 12px 0 8px 0;
      color: var(--accent);
      font-weight: 600;
    }

    .message.ai h3:first-child, .message.ai h4:first-child {
      margin-top: 0;
    }

    .message.ai code {
      background: var(--bg-hover);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.85em;
    }

    .message.ai hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 12px 0;
    }

    .message.ai .highlight-value {
      color: var(--accent);
      font-weight: 600;
    }

    .message.system {
      align-self: center;
      background: transparent;
      color: var(--text-muted);
      font-size: var(--font-size-xs);
      text-align: center;
      padding: var(--space-sm);
    }

    .chat-input-area {
      padding: var(--space-md);
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid var(--glass-border);
      display: flex;
      gap: var(--space-sm);
    }

    .chat-input-area input {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      background: var(--glass-bg-hover);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
    }

    .chat-input-area input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-glow);
    }

    .chat-input-area input::placeholder {
      color: var(--text-muted);
    }

    .send-btn {
      padding: var(--space-sm) var(--space-md);
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ===== API Key Modal ===== */
    .api-key-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: var(--space-lg);
    }

    .api-key-modal.open {
      display: flex;
    }

    .api-key-content {
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      max-width: 420px;
      width: 100%;
      box-shadow: 0 16px 48px var(--glass-shadow);
    }

    .api-key-content h3 {
      margin-bottom: var(--space-sm);
      font-size: var(--font-size-lg);
    }

    .api-key-content p {
      color: var(--text-secondary);
      margin-bottom: var(--space-lg);
      font-size: var(--font-size-sm);
    }

    .api-key-content input {
      width: 100%;
      padding: var(--space-md);
      background: var(--glass-bg-hover);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: var(--font-size-md);
      margin-bottom: var(--space-md);
      transition: all var(--transition-fast);
    }

    .api-key-content input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .api-key-buttons {
      display: flex;
      gap: var(--space-sm);
      justify-content: flex-end;
    }

    .btn-secondary {
      padding: var(--space-sm) var(--space-lg);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      cursor: pointer;
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
    }

    .btn-secondary:hover {
      background: var(--glass-bg-hover);
    }

    .btn-primary {
      padding: var(--space-sm) var(--space-lg);
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      cursor: pointer;
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    /* ===== Typing Indicator ===== */
    .typing-indicator {
      display: flex;
      gap: var(--space-xs);
      padding: var(--space-sm) var(--space-md);
      background: var(--glass-bg-hover);
      border-radius: var(--radius-md);
      width: fit-content;
      border: 1px solid var(--glass-border);
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: var(--text-muted);
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }

    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .container {
        padding: var(--space-md);
      }

      .theme-toggle {
        top: var(--space-md);
        right: var(--space-md);
      }

      header {
        padding: var(--space-lg) var(--space-md);
      }

      header h1 {
        font-size: var(--font-size-xl);
      }

      .stats-summary {
        gap: var(--space-md);
      }

      .stat-value {
        font-size: var(--font-size-lg);
      }

      .controls {
        flex-direction: column;
      }

      .search-box {
        width: 100%;
      }

      .chat-modal {
        bottom: 0;
        right: 0;
        width: 100%;
        max-width: 100%;
        height: calc(100vh - 80px);
        max-height: calc(100vh - 80px);
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state svg {
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* ===== Scrollbar ===== */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--glass-bg);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--glass-border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }
  </style>
</head>
<body>
  <!-- Background -->
  <div class="bg-image"></div>
  <div class="bg-mesh"></div>

  <!-- Theme Toggle -->
  <div class="theme-toggle">
    <button class="theme-btn" id="themeToggle" title="Toggle theme">
      <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
      <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    </button>
  </div>

  <div class="container">
    <header class="glass">
      <h1>ë‚˜ì¸ë¸”ë¡œì»¤ìŠ¤ ë¦¬ê·¸</h1>
      <p>2025ë…„ 8ì›” ì‹œì¦Œ ì„ ìˆ˜ í†µê³„</p>
      <div class="stats-summary">
        <div class="stat-item">
          <div class="stat-value" id="totalRounds">12</div>
          <div class="stat-label">ì´ ë¼ìš´ë“œ</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalPlayers">42</div>
          <div class="stat-label">ì°¸ê°€ ì„ ìˆ˜</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalTeams">3</div>
          <div class="stat-label">íŒ€</div>
        </div>
      </div>
    </header>

    <div class="controls">
      <div class="toggle-group" id="seasonSelector">
        <button class="toggle-btn" data-season="202402">2024ë…„ 2ì›”</button>
        <button class="toggle-btn" data-season="202409">2024ë…„ 9ì›”</button>
        <button class="toggle-btn" data-season="202508">2025ë…„ 8ì›”</button>
        <button class="toggle-btn active" data-season="202601">2026ë…„ 1ì›”</button>
      </div>
      <div class="search-box">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" id="searchInput" placeholder="ì„ ìˆ˜ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰...">
      </div>
    </div>

    <div class="table-wrapper glass">
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>ìˆœìœ„</th>
              <th data-sort="ë²ˆí˜¸">ë²ˆí˜¸<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="íŒ€">íŒ€<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ì„ ìˆ˜ëª…">ì„ ìˆ˜ëª…<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ì¶œì„">ì¶œì„<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ëˆ„ì ë“ì " class="sorted desc">ëˆ„ì ë“ì <span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="í‰ê· ë“ì ">í‰ê· ë“ì <span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ëˆ„ì ì–´ì‹œ">ëˆ„ì ì–´ì‹œ<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="í‰ê· ì–´ì‹œ">í‰ê· ì–´ì‹œ<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ëˆ„ì ë¦¬ë°”">ëˆ„ì ë¦¬ë°”<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="í‰ê· ë¦¬ë°”">í‰ê· ë¦¬ë°”<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ëˆ„ì ìŠ¤í‹¸">ëˆ„ì ìŠ¤í‹¸<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="í‰ê· ìŠ¤í‹¸">í‰ê· ìŠ¤í‹¸<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ëˆ„ì ë¸”ë¡">ëˆ„ì ë¸”ë¡<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="í‰ê· ë¸”ë¡">í‰ê· ë¸”ë¡<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ëˆ„ì 3ì ">ëˆ„ì 3ì <span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="í‰ê· 3ì ">í‰ê· 3ì <span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
            </tr>
          </thead>
          <tbody id="tableBody">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Chat FAB -->
  <button class="chat-fab" id="chatFab" title="AIì—ê²Œ ì§ˆë¬¸í•˜ê¸°">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
  </button>

  <!-- Chat Modal -->
  <div class="chat-modal" id="chatModal">
    <div class="chat-header">
      <h3>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        ë¦¬ê·¸ í†µê³„ AI
      </h3>
      <button class="close-btn" id="closeChat">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="message system">
        ë‚˜ì¸ë¸”ë¡œì»¤ìŠ¤ ë¦¬ê·¸ í†µê³„ì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”!
      </div>
    </div>
    <div class="chat-input-area">
      <input type="text" id="chatInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off">
      <button class="send-btn" id="sendBtn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
  </div>

  <!-- API Key Modal -->
  <div class="api-key-modal" id="apiKeyModal">
    <div class="api-key-content">
      <h3>ğŸ”‘ Gemini API í‚¤ ì…ë ¥</h3>
      <p>AI ì±„íŒ… ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ Google Gemini API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. í‚¤ëŠ” ë¸Œë¼ìš°ì €ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.</p>
      <input type="password" id="apiKeyInput" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
      <div class="api-key-buttons">
        <button class="btn-secondary" id="cancelApiKey">ì·¨ì†Œ</button>
        <button class="btn-primary" id="saveApiKey">ì €ì¥</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // ì‹œì¦Œ ëª©ë¡ (ìƒˆ ì‹œì¦Œ ì¶”ê°€ ì‹œ ë°°ì—´ ì•ì— ì¶”ê°€)
    const SEASONS = ['202601', '202508', '202409', '202402'];

    // JSON ë°ì´í„° ë¡œë”© í•¨ìˆ˜
    async function loadSeasonData(seasonId) {
      const response = await fetch(`league_stats_${seasonId}.json`);
      if (!response.ok) {
        throw new Error(`Failed to load season ${seasonId}`);
      }
      return await response.json();
    }

    async function loadAllSeasons() {
      const data = {};
      await Promise.all(SEASONS.map(async (seasonId) => {
        data[seasonId] = await loadSeasonData(seasonId);
      }));
      return data;
    }

    // ì‹œì¦Œë³„ ë°ì´í„° (JSON íŒŒì¼ì—ì„œ ë™ì  ë¡œë”©)
    let seasonsData = {};

    // í˜„ì¬ ì„ íƒëœ ì‹œì¦Œ ë°ì´í„°
    let currentSeason = '202601';
    let leagueData = seasonsData[currentSeason];

    // ì‹œì¦Œ ì „í™˜ í•¨ìˆ˜
    function switchSeason(season) {
      if (season === currentSeason) return;

      currentSeason = season;
      leagueData = seasonsData[season];

      // UI ì—…ë°ì´íŠ¸
      updateHeader();
      renderTable();

      // ì‹œì¦Œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      document.querySelectorAll('#seasonSelector .toggle-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.season === season);
      });

      // AI ì±„íŒ… íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™” (ì‹œì¦Œ ë³€ê²½ì‹œ)
      chatHistory = [];
    }

    // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸
    function updateHeader() {
      document.title = `ë‚˜ì¸ë¸”ë¡œì»¤ìŠ¤ ë¦¬ê·¸ - ${leagueData.ì‹œì¦Œ} ì‹œì¦Œ`;
      document.querySelector('header p').textContent = `${leagueData.ì‹œì¦Œ} ì‹œì¦Œ ì„ ìˆ˜ í†µê³„`;
      document.getElementById('totalRounds').textContent = leagueData.ì´ë¼ìš´ë“œ;
      document.getElementById('totalPlayers').textContent = leagueData.ì´ì„ ìˆ˜ìˆ˜;
    }

    // ìƒíƒœ ê´€ë¦¬
    let currentSort = { field: 'ëˆ„ì ë“ì ', order: 'desc' };
    let searchQuery = '';
    let apiKey = localStorage.getItem('gemini_api_key') || '';
    let genAI = null;
    let chatHistory = [];

    // DOM ìš”ì†Œ
    const tableBody = document.getElementById('tableBody');
    const searchInput = document.getElementById('searchInput');
    const chatFab = document.getElementById('chatFab');
    const chatModal = document.getElementById('chatModal');
    const closeChat = document.getElementById('closeChat');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const apiKeyModal = document.getElementById('apiKeyModal');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const saveApiKey = document.getElementById('saveApiKey');
    const cancelApiKey = document.getElementById('cancelApiKey');
    const themeToggle = document.getElementById('themeToggle');

    // í…Œë§ˆ í† ê¸€ ê¸°ëŠ¥
    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
    }

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }

    themeToggle.addEventListener('click', toggleTheme);
    initTheme();

    // ë°ì´í„° ê°€ê³µ í•¨ìˆ˜
    function getPlayerValue(player, field) {
      switch (field) {
        case 'ë²ˆí˜¸': return player.ë²ˆí˜¸;
        case 'íŒ€': return player.íŒ€;
        case 'ì„ ìˆ˜ëª…': return player.ì„ ìˆ˜ëª…;
        case 'ì¶œì„': return player.ì¶œì„;
        case 'ëˆ„ì ë“ì ': return player.ë“ì .ëˆ„ì ë“ì ;
        case 'í‰ê· ë“ì ': return player.ë“ì .í‰ê· ë“ì ;
        case 'ëˆ„ì ì–´ì‹œ': return player.ë¶€ê°€ê¸°ë¡.ì–´ì‹œìŠ¤íŠ¸.ëˆ„ì ;
        case 'í‰ê· ì–´ì‹œ': return player.ë¶€ê°€ê¸°ë¡.ì–´ì‹œìŠ¤íŠ¸.í‰ê· ;
        case 'ëˆ„ì ë¦¬ë°”': return player.ë¶€ê°€ê¸°ë¡.ë¦¬ë°”ìš´ë“œ.ëˆ„ì ;
        case 'í‰ê· ë¦¬ë°”': return player.ë¶€ê°€ê¸°ë¡.ë¦¬ë°”ìš´ë“œ.í‰ê· ;
        case 'ëˆ„ì ìŠ¤í‹¸': return player.ë¶€ê°€ê¸°ë¡.ìŠ¤í‹¸.ëˆ„ì ;
        case 'í‰ê· ìŠ¤í‹¸': return player.ë¶€ê°€ê¸°ë¡.ìŠ¤í‹¸.í‰ê· ;
        case 'ëˆ„ì ë¸”ë¡': return player.ë¶€ê°€ê¸°ë¡.ë¸”ë¡.ëˆ„ì ;
        case 'í‰ê· ë¸”ë¡': return player.ë¶€ê°€ê¸°ë¡.ë¸”ë¡.í‰ê· ;
        case 'ëˆ„ì 3ì ': return player.ë¶€ê°€ê¸°ë¡['3ì ìŠ›'].ëˆ„ì ;
        case 'í‰ê· 3ì ': return player.ë¶€ê°€ê¸°ë¡['3ì ìŠ›'].í‰ê· ;
        default: return 0;
      }
    }

    // ì •ë ¬ëœ ì „ì²´ ì„ ìˆ˜ ëª©ë¡ ë°˜í™˜
    function getSortedPlayers() {
      let players = [...leagueData.ì„ ìˆ˜ëª©ë¡];
      
      // ì •ë ¬
      players.sort((a, b) => {
        const aVal = getPlayerValue(a, currentSort.field);
        const bVal = getPlayerValue(b, currentSort.field);
        
        if (typeof aVal === 'string') {
          return currentSort.order === 'asc' 
            ? aVal.localeCompare(bVal) 
            : bVal.localeCompare(aVal);
        }
        
        return currentSort.order === 'asc' ? aVal - bVal : bVal - aVal;
      });
      
      return players;
    }

    // ê²€ìƒ‰ í•„í„°ë§ ì ìš©
    function getFilteredPlayers(sortedPlayers) {
      if (!searchQuery) {
        return sortedPlayers;
      }
      
      return sortedPlayers.filter(p => 
        p.ì„ ìˆ˜ëª….toLowerCase().includes(searchQuery.toLowerCase())
      );
    }

    // í˜„ì¬ ì •ë ¬ ê¸°ì¤€ì— ë”°ë¼ highlight í´ë˜ìŠ¤ ë°˜í™˜
    function getHighlightClass(field) {
      return currentSort.field === field ? 'highlight' : '';
    }

    // í…Œì´ë¸” ë Œë”ë§
    function renderTable() {
      const sortedPlayers = getSortedPlayers();
      const filteredPlayers = getFilteredPlayers(sortedPlayers);
      
      // ì •ë ¬ëœ ì „ì²´ ëª©ë¡ì—ì„œ ê° ì„ ìˆ˜ì˜ ìˆœìœ„ ë§µ ìƒì„±
      const rankMap = new Map();
      sortedPlayers.forEach((player, index) => {
        rankMap.set(player.ì„ ìˆ˜ëª…, index + 1);
      });
      
      if (filteredPlayers.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="17">
              <div class="empty-state">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }
      
      tableBody.innerHTML = filteredPlayers.map(player => {
        const rank = rankMap.get(player.ì„ ìˆ˜ëª…);
        const rankClass = rank <= 3 ? `rank rank-${rank}` : 'rank';
        return `
        <tr>
          <td class="${rankClass}">${rank}</td>
          <td class="${getHighlightClass('ë²ˆí˜¸')}">${player.ë²ˆí˜¸}</td>
          <td class="${getHighlightClass('íŒ€')}"><span class="team-badge team-${player.íŒ€}">${player.íŒ€}</span></td>
          <td class="player-name ${getHighlightClass('ì„ ìˆ˜ëª…')}">${player.ì„ ìˆ˜ëª…}</td>
          <td class="${getHighlightClass('ì¶œì„')}">${player.ì¶œì„}</td>
          <td class="${getHighlightClass('ëˆ„ì ë“ì ')}">${player.ë“ì .ëˆ„ì ë“ì }</td>
          <td class="${getHighlightClass('í‰ê· ë“ì ')}">${player.ë“ì .í‰ê· ë“ì .toFixed(1)}</td>
          <td class="${getHighlightClass('ëˆ„ì ì–´ì‹œ')}">${player.ë¶€ê°€ê¸°ë¡.ì–´ì‹œìŠ¤íŠ¸.ëˆ„ì }</td>
          <td class="${getHighlightClass('í‰ê· ì–´ì‹œ')}">${player.ë¶€ê°€ê¸°ë¡.ì–´ì‹œìŠ¤íŠ¸.í‰ê· .toFixed(1)}</td>
          <td class="${getHighlightClass('ëˆ„ì ë¦¬ë°”')}">${player.ë¶€ê°€ê¸°ë¡.ë¦¬ë°”ìš´ë“œ.ëˆ„ì }</td>
          <td class="${getHighlightClass('í‰ê· ë¦¬ë°”')}">${player.ë¶€ê°€ê¸°ë¡.ë¦¬ë°”ìš´ë“œ.í‰ê· .toFixed(1)}</td>
          <td class="${getHighlightClass('ëˆ„ì ìŠ¤í‹¸')}">${player.ë¶€ê°€ê¸°ë¡.ìŠ¤í‹¸.ëˆ„ì }</td>
          <td class="${getHighlightClass('í‰ê· ìŠ¤í‹¸')}">${player.ë¶€ê°€ê¸°ë¡.ìŠ¤í‹¸.í‰ê· .toFixed(1)}</td>
          <td class="${getHighlightClass('ëˆ„ì ë¸”ë¡')}">${player.ë¶€ê°€ê¸°ë¡.ë¸”ë¡.ëˆ„ì }</td>
          <td class="${getHighlightClass('í‰ê· ë¸”ë¡')}">${player.ë¶€ê°€ê¸°ë¡.ë¸”ë¡.í‰ê· .toFixed(1)}</td>
          <td class="${getHighlightClass('ëˆ„ì 3ì ')}">${player.ë¶€ê°€ê¸°ë¡['3ì ìŠ›'].ëˆ„ì }</td>
          <td class="${getHighlightClass('í‰ê· 3ì ')}">${player.ë¶€ê°€ê¸°ë¡['3ì ìŠ›'].í‰ê· .toFixed(1)}</td>
        </tr>
      `;}).join('');
    }

    // ì •ë ¬ í—¤ë” ì—…ë°ì´íŠ¸
    function updateSortHeaders() {
      document.querySelectorAll('th').forEach(th => {
        th.classList.remove('sorted', 'asc', 'desc');
        if (th.dataset.sort === currentSort.field) {
          th.classList.add('sorted', currentSort.order);
        }
      });
    }

    // ì •ë ¬ í´ë¦­ í•¸ë“¤ëŸ¬
    document.querySelectorAll('th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const field = th.dataset.sort;
        if (currentSort.field === field) {
          currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.field = field;
          currentSort.order = 'desc';
        }
        updateSortHeaders();
        renderTable();
      });
    });

    // ê²€ìƒ‰ í•¸ë“¤ëŸ¬
    searchInput.addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderTable();
    });

    // ì±„íŒ… ëª¨ë‹¬ í† ê¸€
    chatFab.addEventListener('click', () => {
      if (!apiKey) {
        apiKeyModal.classList.add('open');
        return;
      }
      chatModal.classList.toggle('open');
    });

    closeChat.addEventListener('click', () => {
      chatModal.classList.remove('open');
    });

    // API í‚¤ ëª¨ë‹¬
    saveApiKey.addEventListener('click', () => {
      const key = apiKeyInput.value.trim();
      if (key) {
        apiKey = key;
        localStorage.setItem('gemini_api_key', key);
        initGemini();
        apiKeyModal.classList.remove('open');
        chatModal.classList.add('open');
        apiKeyInput.value = '';
      }
    });

    cancelApiKey.addEventListener('click', () => {
      apiKeyModal.classList.remove('open');
      apiKeyInput.value = '';
    });

    // Gemini ì´ˆê¸°í™”
    function initGemini() {
      if (apiKey) {
        genAI = new GoogleGenerativeAI(apiKey);
      }
    }

    // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±
    function getSystemPrompt() {
      const playersSummary = leagueData.ì„ ìˆ˜ëª©ë¡.map(p =>
        `${p.ì„ ìˆ˜ëª…}(#${p.ë²ˆí˜¸}, íŒ€${p.íŒ€}): ë“ì  ${p.ë“ì .í‰ê· ë“ì }(í‰ê· )/${p.ë“ì .ëˆ„ì ë“ì }(ëˆ„ì ), ` +
        `ì–´ì‹œìŠ¤íŠ¸ ${p.ë¶€ê°€ê¸°ë¡.ì–´ì‹œìŠ¤íŠ¸.í‰ê· }/${p.ë¶€ê°€ê¸°ë¡.ì–´ì‹œìŠ¤íŠ¸.ëˆ„ì }, ` +
        `ë¦¬ë°”ìš´ë“œ ${p.ë¶€ê°€ê¸°ë¡.ë¦¬ë°”ìš´ë“œ.í‰ê· }/${p.ë¶€ê°€ê¸°ë¡.ë¦¬ë°”ìš´ë“œ.ëˆ„ì }, ` +
        `ìŠ¤í‹¸ ${p.ë¶€ê°€ê¸°ë¡.ìŠ¤í‹¸.í‰ê· }/${p.ë¶€ê°€ê¸°ë¡.ìŠ¤í‹¸.ëˆ„ì }, ` +
        `ë¸”ë¡ ${p.ë¶€ê°€ê¸°ë¡.ë¸”ë¡.í‰ê· }/${p.ë¶€ê°€ê¸°ë¡.ë¸”ë¡.ëˆ„ì }, ` +
        `3ì ìŠ› ${p.ë¶€ê°€ê¸°ë¡['3ì ìŠ›'].í‰ê· }/${p.ë¶€ê°€ê¸°ë¡['3ì ìŠ›'].ëˆ„ì }, ` +
        `ì¶œì„ ${p.ì¶œì„}ê²½ê¸°`
      ).join('\n');

      return `ë‹¹ì‹ ì€ "ë‚˜ì¸ë¸”ë¡œì»¤ìŠ¤" ë†êµ¬ ë¦¬ê·¸ì˜ ê³µì‹ í†µê³„ ë¶„ì„ AIì…ë‹ˆë‹¤.

## ì‹œì¦Œ ì •ë³´
- ì‹œì¦Œ: ${leagueData.ì‹œì¦Œ}
- ì´ ë¼ìš´ë“œ: ${leagueData.ì´ë¼ìš´ë“œ}
- ì´ ì„ ìˆ˜: ${leagueData.ì´ì„ ìˆ˜ìˆ˜}ëª…
- íŒ€: A, B, C

## ì„ ìˆ˜ ë°ì´í„° (ì´ë¦„, ë²ˆí˜¸, íŒ€, í‰ê· /ëˆ„ì  ê¸°ë¡)
${playersSummary}

## ë‹¹ì‹ ì˜ ì—­í• 
1. ìœ„ ì„ ìˆ˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§ˆë¬¸ì— ì •í™•í•˜ê²Œ ë‹µë³€í•©ë‹ˆë‹¤.
2. ë“ì ì™•, ì–´ì‹œìŠ¤íŠ¸ì™•, ë¦¬ë°”ìš´ë“œì™• ë“± ê° ë¶€ë¬¸ë³„ 1ìœ„ë¥¼ ì°¾ì•„ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. íŠ¹ì • ì„ ìˆ˜ì˜ ê¸°ë¡ì„ ì•Œë ¤ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. íŒ€ë³„ í†µê³„ ë¹„êµë¥¼ í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
5. ì„ ìˆ˜ë“¤ì˜ ê°•ì ê³¼ ì•½ì ì„ ë¶„ì„í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì¤‘ìš” ê·œì¹™
- ë°˜ë“œì‹œ ìœ„ ë°ì´í„°ì— ìˆëŠ” ì •ë³´ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
- ì´ ë¦¬ê·¸ í†µê³„ì™€ ê´€ë ¨ ì—†ëŠ” ì§ˆë¬¸(ë‚ ì”¨, ì¼ë°˜ ìƒì‹, ë‹¤ë¥¸ ìŠ¤í¬ì¸  ë“±)ì—ëŠ” ì •ì¤‘í•˜ê²Œ "ì£„ì†¡í•©ë‹ˆë‹¤. ì €ëŠ” ë‚˜ì¸ë¸”ë¡œì»¤ìŠ¤ ë¦¬ê·¸ í†µê³„ì— ëŒ€í•œ ì§ˆë¬¸ì—ë§Œ ë‹µë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."ë¼ê³  ê±°ì ˆí•˜ì„¸ìš”.
- ë‹µë³€ì€ í•œêµ­ì–´ë¡œ ì¹œì ˆí•˜ê³  ê°„ê²°í•˜ê²Œ í•´ì£¼ì„¸ìš”.
- ìˆ«ì ë°ì´í„°ë¥¼ ì¸ìš©í•  ë•ŒëŠ” ì •í™•í•˜ê²Œ í•´ì£¼ì„¸ìš”.

## ë‹µë³€ í˜•ì‹ ê°€ì´ë“œ (ë§¤ìš° ì¤‘ìš”!)
í™”ë©´ì´ ì¢ì„ ìˆ˜ ìˆìœ¼ë‹ˆ ê°„ê²°í•˜ê²Œ ë‹µë³€í•˜ì„¸ìš”.

1. **ìˆœìœ„/ë­í‚¹ ì§ˆë¬¸** (ë“ì  ìƒìœ„ Nìœ„ ë“±):
   - í…Œì´ë¸”ì€ **ìµœëŒ€ 3~4ê°œ ì»¬ëŸ¼**ë§Œ ì‚¬ìš©
   - ì»¬ëŸ¼ëª…ì€ ì§§ê²Œ: ìˆœìœ„â†’#, ì„ ìˆ˜ëª…â†’ì„ ìˆ˜, ê¸°ë¡â†’ìˆ˜ì¹˜
   - ì˜ˆì‹œ:
   | # | ì„ ìˆ˜ | íŒ€ | ë“ì  |
   |---|------|----|----|
   | 1 | ê°•ì¬í›ˆ | B | 48.6 |
   | 2 | ì•ˆë³‘ì›… | A | 38.8 |

2. **íŠ¹ì • ì„ ìˆ˜ ì •ë³´**:
   - ë¦¬ìŠ¤íŠ¸ í˜•ì‹ ì‚¬ìš© (í…Œì´ë¸” X)
   - ì˜ˆì‹œ:
   **ê¹€ì •í˜¸** (#32, AíŒ€)
   - ë“ì : 11.4 / 114
   - ì–´ì‹œ: 11.5 / 115
   - ë¦¬ë°”: 8.5 / 85

3. **ë¹„êµ ì§ˆë¬¸**:
   - 2~3ê°œ í•­ëª© ë¹„êµì‹œ ë¦¬ìŠ¤íŠ¸
   - ë§ì€ í•­ëª© ë¹„êµì‹œ ê°„ê²°í•œ í…Œì´ë¸”

4. **ì¼ë°˜ ì›ì¹™**:
   - ìˆ«ìëŠ” ì†Œìˆ˜ì  1ìë¦¬ê¹Œì§€ë§Œ
   - ë¶ˆí•„ìš”í•œ ì„¤ëª… ìƒëµ
   - í•µì‹¬ë§Œ **êµµê²Œ** ê°•ì¡°`;
    }

    // ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ íŒŒì„œ
    function parseMarkdown(text) {
      // í…Œì´ë¸” íŒŒì‹± (ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ wrapperë¡œ ê°ì‹¸ê¸°)
      text = text.replace(/\n?\|(.+)\|\n\|[-\s|]+\|\n((?:\|.+\|\n?)+)/g, (match, header, body) => {
        const headers = header.split('|').map(h => h.trim()).filter(h => h);
        const rows = body.trim().split('\n').map(row => 
          row.split('|').map(cell => cell.trim()).filter(cell => cell)
        );
        
        let table = '<div class="table-wrapper"><table><thead><tr>';
        headers.forEach(h => table += `<th>${h}</th>`);
        table += '</tr></thead><tbody>';
        rows.forEach(row => {
          table += '<tr>';
          row.forEach(cell => table += `<td>${cell}</td>`);
          table += '</tr>';
        });
        table += '</tbody></table></div>';
        return table;
      });

      // ë³¼ë“œ ì²˜ë¦¬
      text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      
      // ì´íƒ¤ë¦­ ì²˜ë¦¬
      text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');
      
      // ì¸ë¼ì¸ ì½”ë“œ
      text = text.replace(/`(.+?)`/g, '<code>$1</code>');
      
      // í—¤ë” ì²˜ë¦¬
      text = text.replace(/^#### (.+)$/gm, '<h4>$1</h4>');
      text = text.replace(/^### (.+)$/gm, '<h3>$1</h3>');
      
      // ìˆ˜í‰ì„ 
      text = text.replace(/^---$/gm, '<hr>');
      
      // ìˆœì„œ ìˆëŠ” ë¦¬ìŠ¤íŠ¸
      text = text.replace(/^(\d+)\. (.+)$/gm, '<li data-num="$1">$2</li>');
      text = text.replace(/(<li data-num="\d+">.+<\/li>\n?)+/g, (match) => `<ol>${match}</ol>`);
      text = text.replace(/ data-num="\d+"/g, '');
      
      // ìˆœì„œ ì—†ëŠ” ë¦¬ìŠ¤íŠ¸
      text = text.replace(/^- (.+)$/gm, '<li>$1</li>');
      text = text.replace(/(<li>.+<\/li>\n?)+/g, (match) => {
        if (!match.includes('<ol>')) return `<ul>${match}</ul>`;
        return match;
      });
      
      // ì¤„ë°”ê¿ˆì„ <br>ë¡œ ë³€í™˜ (ë¦¬ìŠ¤íŠ¸/í…Œì´ë¸”/í—¤ë” íƒœê·¸ ë’¤ëŠ” ì œì™¸)
      text = text.replace(/\n(?!<)/g, '<br>');
      
      // ì—°ì†ëœ <br> ì •ë¦¬
      text = text.replace(/(<br>){3,}/g, '<br><br>');
      
      // íƒœê·¸ ë’¤ ë¶ˆí•„ìš”í•œ <br> ì œê±°
      text = text.replace(/<\/(table|ul|ol|h3|h4|hr)><br>/g, '</$1>');
      text = text.replace(/<br><(table|ul|ol|h3|h4|hr)/g, '<$1');
      
      return text;
    }

    // ë©”ì‹œì§€ ì¶”ê°€
    function addMessage(content, type) {
      const div = document.createElement('div');
      div.className = `message ${type}`;
      
      if (type === 'ai') {
        // AI ë©”ì‹œì§€ëŠ” ë§ˆí¬ë‹¤ìš´ íŒŒì‹±
        div.innerHTML = parseMarkdown(content);
      } else {
        div.textContent = content;
      }
      
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì¶”ê°€
    function addTypingIndicator() {
      const div = document.createElement('div');
      div.className = 'typing-indicator';
      div.id = 'typingIndicator';
      div.innerHTML = '<span></span><span></span><span></span>';
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì œê±°
    function removeTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) indicator.remove();
    }

    // ë©”ì‹œì§€ ì „ì†¡
    async function sendMessage() {
      const message = chatInput.value.trim();
      if (!message || !genAI) return;

      chatInput.value = '';
      sendBtn.disabled = true;
      addMessage(message, 'user');
      addTypingIndicator();

      try {
        const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
        
        // ëŒ€í™” íˆìŠ¤í† ë¦¬ êµ¬ì„±
        const historyFormatted = chatHistory.map(h => ({
          role: h.role,
          parts: [{ text: h.content }]
        }));

        const chat = model.startChat({
          history: historyFormatted,
          systemInstruction: {
            parts: [{ text: getSystemPrompt() }]
          }
        });

        const result = await chat.sendMessage(message);
        const response = await result.response;
        const text = response.text();

        // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
        chatHistory.push({ role: 'user', content: message });
        chatHistory.push({ role: 'model', content: text });

        removeTypingIndicator();
        addMessage(text, 'ai');
      } catch (error) {
        console.error('Gemini API Error:', error);
        removeTypingIndicator();
        
        let errorMsg = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        if (error.message) {
          if (error.message.includes('API_KEY_INVALID') || error.message.includes('API key not valid')) {
            errorMsg = 'API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
          } else if (error.message.includes('PERMISSION_DENIED')) {
            errorMsg = 'API ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. Gemini APIê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.';
          } else if (error.message.includes('RESOURCE_EXHAUSTED') || error.message.includes('quota')) {
            errorMsg = 'API í• ë‹¹ëŸ‰ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
          } else if (error.message.includes('fetch') || error.message.includes('network')) {
            errorMsg = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
          } else {
            errorMsg = `ì˜¤ë¥˜: ${error.message}`;
          }
        }
        addMessage(errorMsg, 'system');
      }

      sendBtn.disabled = false;
    }

    // ì „ì†¡ ë²„íŠ¼ í´ë¦­
    sendBtn.addEventListener('click', sendMessage);

    // Enter í‚¤ë¡œ ì „ì†¡
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // ì‹œì¦Œ ì„ íƒ í•¸ë“¤ëŸ¬
    document.querySelectorAll('#seasonSelector .toggle-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        switchSeason(btn.dataset.season);
      });
    });

    // ì•± ì´ˆê¸°í™” (ë¹„ë™ê¸°)
    async function initApp() {
      try {
        seasonsData = await loadAllSeasons();
        leagueData = seasonsData[currentSeason];
        initGemini();
        renderTable();
        updateSortHeaders();
      } catch (error) {
        console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
        document.querySelector('.container').innerHTML = `
          <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
            <h2>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</h2>
            <p>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.</p>
          </div>
        `;
      }
    }

    initApp();

    // ê³ ì • í—¤ë” ê¸°ëŠ¥
    const tableWrapper = document.querySelector('.table-wrapper');
    const tableScroll = document.querySelector('.table-scroll');
    const originalThead = document.querySelector('table thead');
    let fixedHeaderContainer = null;
    let fixedHeaderOverlay = null;

    function createFixedHeader() {
      if (fixedHeaderContainer) return;

      // ìƒë‹¨ ì˜¤ë²„ë ˆì´ ìƒì„±
      fixedHeaderOverlay = document.createElement('div');
      fixedHeaderOverlay.className = 'fixed-header-overlay';
      document.body.appendChild(fixedHeaderOverlay);

      // ê³ ì • í—¤ë” ìƒì„±
      fixedHeaderContainer = document.createElement('div');
      fixedHeaderContainer.className = 'fixed-header';
      fixedHeaderContainer.style.display = 'none';

      const table = document.createElement('table');
      table.innerHTML = originalThead.outerHTML;
      fixedHeaderContainer.appendChild(table);

      document.body.appendChild(fixedHeaderContainer);

      // ê³ ì • í—¤ë”ì˜ ì •ë ¬ ì´ë²¤íŠ¸ ì—°ê²°
      fixedHeaderContainer.querySelectorAll('th[data-sort]').forEach(th => {
        th.addEventListener('click', () => {
          const field = th.dataset.sort;
          if (currentSort.field === field) {
            currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
          } else {
            currentSort.field = field;
            currentSort.order = 'desc';
          }
          updateSortHeaders();
          updateFixedHeaderSort();
          renderTable();
        });
      });
    }

    function updateFixedHeaderSort() {
      if (!fixedHeaderContainer) return;
      fixedHeaderContainer.querySelectorAll('th').forEach(th => {
        th.classList.remove('sorted', 'asc', 'desc');
        if (th.dataset.sort === currentSort.field) {
          th.classList.add('sorted', currentSort.order);
        }
      });
    }

    function updateFixedHeader() {
      if (!fixedHeaderContainer) return;

      const wrapperRect = tableWrapper.getBoundingClientRect();
      const theadRect = originalThead.getBoundingClientRect();
      const tableRect = tableScroll.querySelector('table').getBoundingClientRect();

      // theadê°€ í™”ë©´ ìƒë‹¨ì„ ë²—ì–´ë‚¬ê³ , í…Œì´ë¸”ì´ ì•„ì§ í™”ë©´ì— ìˆì„ ë•Œ
      const shouldFix = theadRect.top <= 0 && wrapperRect.bottom > theadRect.height;

      if (shouldFix) {
        // ê³ ì • í—¤ë” í‘œì‹œ
        fixedHeaderContainer.style.display = 'block';
        fixedHeaderContainer.style.top = '16px';
        fixedHeaderContainer.style.left = wrapperRect.left + 'px';
        fixedHeaderContainer.style.width = wrapperRect.width + 'px';

        // ì˜¤ë²„ë ˆì´ í‘œì‹œ (ê³ ì • í—¤ë” ë’¤ê¹Œì§€ ë®ë„ë¡)
        const fixedHeaderHeight = fixedHeaderContainer.offsetHeight;
        fixedHeaderOverlay.style.display = 'block';
        fixedHeaderOverlay.style.left = wrapperRect.left + 'px';
        fixedHeaderOverlay.style.width = wrapperRect.width + 'px';
        fixedHeaderOverlay.style.height = (16 + fixedHeaderHeight) + 'px';

        // ê°€ë¡œ ìŠ¤í¬ë¡¤ ë™ê¸°í™”
        const scrollLeft = tableScroll.scrollLeft;
        fixedHeaderContainer.querySelector('table').style.transform = `translateX(-${scrollLeft}px)`;
        fixedHeaderContainer.querySelector('table').style.width = tableRect.width + 'px';

        // ì»¬ëŸ¼ ë„ˆë¹„ ë™ê¸°í™”
        const originalThs = originalThead.querySelectorAll('th');
        const fixedThs = fixedHeaderContainer.querySelectorAll('th');
        originalThs.forEach((th, i) => {
          fixedThs[i].style.width = th.offsetWidth + 'px';
          fixedThs[i].style.minWidth = th.offsetWidth + 'px';
        });
      } else {
        fixedHeaderContainer.style.display = 'none';
        fixedHeaderOverlay.style.display = 'none';
      }
    }

    // ì´ˆê¸°í™”
    createFixedHeader();
    updateFixedHeaderSort();

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    window.addEventListener('scroll', updateFixedHeader);
    window.addEventListener('resize', updateFixedHeader);
    tableScroll.addEventListener('scroll', updateFixedHeader);

    // MutationObserverë¡œ í…Œì´ë¸” ë³€ê²½ ê°ì§€
    const observer = new MutationObserver(() => {
      updateFixedHeader();
      updateFixedHeaderSort();
    });
    observer.observe(originalThead, { childList: true, subtree: true, attributes: true });
  </script>
</body>
</html>


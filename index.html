<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÎÇòÏù∏Î∏îÎ°úÏª§Ïä§ Î¶¨Í∑∏ - 2026ÎÖÑ 1Ïõî ÏãúÏ¶å</title>
  <style>
    /* ===== Design Tokens ===== */
    :root {
      /* Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;

      /* Typography */
      --font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-md: 1rem;
      --font-size-lg: 1.25rem;
      --font-size-xl: 1.5rem;
      --font-size-2xl: 2rem;

      /* Border Radius */
      --radius-sm: 12px;
      --radius-md: 20px;
      --radius-lg: 28px;
      --radius-full: 9999px;

      /* Transitions */
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);

      /* Team Colors */
      --team-a: #3b82f6;
      --team-b: #22c55e;
      --team-c: #f59e0b;
    }

    /* ===== Dark Theme ===== */
    [data-theme="dark"] {
      --bg-base: transparent;
      --bg-gradient-start: rgba(0, 0, 0, 0.6);
      --bg-gradient-end: rgba(0, 0, 0, 0.75);
      --bg-mesh-1: rgba(80, 80, 120, 0.1);
      --bg-mesh-2: rgba(100, 60, 140, 0.08);
      --bg-mesh-3: rgba(60, 100, 140, 0.06);

      --glass-bg: rgba(20, 20, 25, 0.6);
      --glass-bg-hover: rgba(30, 30, 35, 0.7);
      --glass-border: rgba(255, 255, 255, 0.15);
      --glass-border-hover: rgba(255, 255, 255, 0.25);
      --glass-shadow: rgba(0, 0, 0, 0.5);
      --glass-highlight: rgba(255, 255, 255, 0.08);
      --glass-shine: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 40%);

      /* Button/Filter glass */
      --btn-glass-bg: rgba(255, 255, 255, 0.03);
      --btn-glass-border: rgba(255, 255, 255, 0.1);

      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.45);

      --accent: #ff6b35;
      --accent-hover: #ff8555;
      --accent-glow: rgba(255, 107, 53, 0.5);

      --medal-gold: #ffd700;
      --medal-silver: #c0c0c0;
      --medal-bronze: #cd7f32;

      /* Dark theme team badge colors */
      --team-a-bg: rgba(255, 255, 255, 0.04);
      --team-b-bg: rgba(255, 255, 255, 0.04);
      --team-c-bg: rgba(255, 255, 255, 0.04);
      --team-a: #60a5fa;
      --team-b: #4ade80;
      --team-c: #fbbf24;

      /* Active filter glass */
      --active-glass-bg: rgba(255, 107, 53, 0.12);
      --active-glass-border: rgba(255, 107, 53, 0.25);

      --border: rgba(255, 255, 255, 0.1);
      --bg-hover: rgba(255, 255, 255, 0.05);
    }

    /* ===== Light Theme ===== */
    [data-theme="light"] {
      --bg-base: transparent;
      --bg-gradient-start: rgba(245, 245, 250, 0.7);
      --bg-gradient-end: rgba(235, 235, 245, 0.8);
      --bg-mesh-1: rgba(59, 130, 246, 0.1);
      --bg-mesh-2: rgba(139, 92, 246, 0.08);
      --bg-mesh-3: rgba(236, 72, 153, 0.05);

      --glass-bg: rgba(255, 255, 255, 0.6);
      --glass-bg-hover: rgba(255, 255, 255, 0.75);
      --glass-border: rgba(255, 255, 255, 0.8);
      --glass-border-hover: rgba(255, 255, 255, 0.95);
      --glass-shadow: rgba(0, 0, 0, 0.08);
      --glass-highlight: rgba(255, 255, 255, 0.95);
      --glass-shine: linear-gradient(135deg, rgba(255,255,255,0.7) 0%, transparent 50%);

      /* Button/Filter glass */
      --btn-glass-bg: rgba(255, 255, 255, 0.5);
      --btn-glass-border: rgba(255, 255, 255, 0.7);

      --text-primary: rgba(0, 0, 0, 0.88);
      --text-secondary: rgba(0, 0, 0, 0.55);
      --text-muted: rgba(0, 0, 0, 0.35);

      --accent: #e55a2b;
      --accent-hover: #d04a1b;
      --accent-glow: rgba(229, 90, 43, 0.3);

      --medal-gold: #d4a800;
      --medal-silver: #8a8a8a;
      --medal-bronze: #a56324;

      /* Light theme team badge colors */
      --team-a-bg: rgba(59, 130, 246, 0.15);
      --team-b-bg: rgba(34, 197, 94, 0.15);
      --team-c-bg: rgba(245, 158, 11, 0.15);
      --team-a: #2563eb;
      --team-b: #16a34a;
      --team-c: #d97706;

      /* Active filter glass */
      --active-glass-bg: rgba(229, 90, 43, 0.15);
      --active-glass-border: rgba(229, 90, 43, 0.4);

      --border: rgba(0, 0, 0, 0.1);
      --bg-hover: rgba(0, 0, 0, 0.03);
    }

    /* ===== Base Styles ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-family);
      background: transparent;
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      transition: color var(--transition-slow);
    }

    /* ===== Background Image ===== */
    .bg-image {
      position: fixed;
      inset: 0;
      z-index: -2;
      background-image: url('https://images.unsplash.com/photo-1546519638-68e109498ffc?q=80&w=2090&auto=format&fit=crop');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* ===== Animated Background Overlay ===== */
    .bg-mesh {
      position: fixed;
      inset: 0;
      z-index: -1;
      background:
        radial-gradient(ellipse 80% 50% at 20% 30%, var(--bg-mesh-1), transparent),
        radial-gradient(ellipse 60% 60% at 80% 20%, var(--bg-mesh-2), transparent),
        radial-gradient(ellipse 50% 40% at 50% 80%, var(--bg-mesh-3), transparent),
        linear-gradient(180deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      transition: all var(--transition-slow);
    }

    /* ===== Liquid Glass Classes ===== */
    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      box-shadow:
        0 8px 32px var(--glass-shadow),
        inset 0 1px 0 var(--glass-highlight),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
      transition: all var(--transition-normal);
    }

    .glass::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at 20% 20%, var(--glass-highlight), transparent 60%);
      pointer-events: none;
      border-radius: inherit;
      opacity: 0.8;
    }

    .glass::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      pointer-events: none;
    }

    .glass:hover:not(header):not(.table-wrapper) {
      background: var(--glass-bg-hover);
      border-color: var(--glass-border-hover);
      transform: translateY(-2px);
      box-shadow:
        0 12px 40px var(--glass-shadow),
        inset 0 1px 0 var(--glass-highlight);
    }

    /* Header - no hover effect */
    header.glass:hover {
      background: var(--glass-bg);
      border-color: var(--glass-border);
      transform: none;
      box-shadow:
        0 8px 32px var(--glass-shadow),
        inset 0 1px 0 var(--glass-highlight);
    }

    /* ===== Container ===== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--space-lg);
      position: relative;
      z-index: 1;
    }

    /* ===== Theme Toggle ===== */
    .theme-toggle {
      position: fixed;
      top: var(--space-lg);
      right: var(--space-lg);
      z-index: 100;
    }

    .theme-btn {
      width: 48px;
      height: 48px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-full);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-primary);
      transition: all var(--transition-normal);
      box-shadow: 0 4px 16px var(--glass-shadow);
    }

    .theme-btn:hover {
      transform: scale(1.1) rotate(15deg);
      background: var(--glass-bg-hover);
    }

    .theme-btn svg {
      width: 24px;
      height: 24px;
      transition: transform var(--transition-normal);
    }

    .sun-icon { display: none; }
    .moon-icon { display: block; }

    [data-theme="light"] .sun-icon { display: block; }
    [data-theme="light"] .moon-icon { display: none; }

    /* ===== Header ===== */
    header {
      text-align: center;
      margin-bottom: var(--space-xl);
      padding: var(--space-2xl) var(--space-lg);
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    header h1 {
      font-size: var(--font-size-2xl);
      font-weight: 700;
      margin-bottom: var(--space-sm);
      background: linear-gradient(135deg, var(--accent) 0%, #ffd700 50%, #4a9eff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 200% auto;
      animation: gradient-shift 5s ease infinite;
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% center; }
      50% { background-position: 100% center; }
    }

    header p {
      color: var(--text-secondary);
      font-size: var(--font-size-lg);
    }

    /* Stats Summary Pills */
    .stats-summary {
      display: flex;
      justify-content: center;
      gap: var(--space-lg);
      margin-top: var(--space-xl);
      flex-wrap: wrap;
    }

    .stat-item {
      padding: var(--space-md) var(--space-lg);
      text-align: center;
      min-width: 100px;
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
      box-shadow: 0 2px 8px var(--glass-shadow);
    }

    .stat-value {
      font-size: var(--font-size-xl);
      font-weight: 700;
      color: var(--accent);
      text-shadow: 0 0 20px var(--accent-glow);
    }

    .stat-label {
      font-size: var(--font-size-xs);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-top: var(--space-xs);
    }

    /* ===== League Info (Standings & Awards) ===== */
    .league-info {
      margin-top: var(--space-xl);
      padding-top: var(--space-lg);
      border-top: 1px solid var(--glass-border);
    }

    .current-round-row {
      display: flex;
      justify-content: center;
      margin-bottom: var(--space-lg);
    }

    .current-round-badge {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-lg);
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      border-radius: var(--radius-full);
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    .round-label {
      font-size: var(--font-size-xs);
      color: rgba(255, 255, 255, 0.8);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .round-value {
      font-size: var(--font-size-xl);
      font-weight: 700;
      color: white;
    }

    .round-total {
      font-size: var(--font-size-sm);
      color: rgba(255, 255, 255, 0.8);
    }

    .standings-row {
      display: flex;
      justify-content: center;
      gap: var(--space-md);
      flex-wrap: wrap;
      margin-bottom: var(--space-lg);
    }

    .standing-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
    }

    .standing-rank {
      font-weight: 700;
      color: var(--text-muted);
      font-size: var(--font-size-sm);
    }

    .standing-item:first-child .standing-rank {
      color: var(--medal-gold);
    }

    .standing-item:nth-child(2) .standing-rank {
      color: var(--medal-silver);
    }

    .standing-item:nth-child(3) .standing-rank {
      color: var(--medal-bronze);
    }

    .standing-record {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }

    .standing-points {
      font-weight: 600;
      font-size: var(--font-size-sm);
      color: var(--accent);
    }

    .awards-row {
      display: flex;
      justify-content: center;
      gap: var(--space-lg);
      flex-wrap: wrap;
    }

    .award-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
    }

    .award-icon {
      font-size: var(--font-size-lg);
    }

    .award-label {
      font-size: var(--font-size-xs);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .award-value {
      font-weight: 600;
      font-size: var(--font-size-sm);
      color: var(--text-primary);
    }

    .excel-link-row {
      display: flex;
      justify-content: center;
      margin-top: var(--space-lg);
    }

    .excel-link-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: var(--font-size-sm);
      text-decoration: none;
      transition: all var(--transition-normal);
    }

    .excel-link-btn:hover {
      background: var(--glass-bg-hover);
      border-color: var(--glass-border-hover);
      color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--glass-shadow);
    }

    .excel-link-btn svg {
      opacity: 0.7;
      transition: opacity var(--transition-fast);
    }

    .excel-link-btn:hover svg {
      opacity: 1;
    }

    /* ===== Controls ===== */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
      align-items: center;
    }

    /* Season Toggle - Segmented Control */
    .toggle-group {
      display: flex;
      padding: var(--space-xs);
      gap: var(--space-xs);
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
    }

    .toggle-btn {
      padding: var(--space-sm) var(--space-md);
      background: transparent;
      border: 1px solid transparent;
      color: var(--text-secondary);
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all var(--transition-normal);
      position: relative;
    }

    .toggle-btn.active {
      background: var(--active-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--active-glass-border);
      color: var(--accent);
      box-shadow: 0 2px 12px var(--accent-glow);
    }

    .toggle-btn:hover:not(.active) {
      background: var(--glass-bg-hover);
      border-color: var(--glass-border-hover);
      color: var(--text-primary);
    }

    /* Search Box */
    .search-box {
      position: relative;
      flex: 1;
      min-width: 280px;
    }

    .search-box input {
      width: 100%;
      padding: var(--space-md) var(--space-md) var(--space-md) 48px;
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: var(--font-size-md);
      transition: all var(--transition-normal);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-glow);
      background: var(--glass-bg-hover);
    }

    .search-box input::placeholder {
      color: var(--text-muted);
    }

    .search-box svg {
      position: absolute;
      left: var(--space-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
    }

    /* ===== Table ===== */
    .table-wrapper {
      overflow: hidden;
      margin-bottom: 100px;
    }

    .table-scroll {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 900px;
    }

    th, td {
      padding: var(--space-md);
      text-align: center;
      white-space: nowrap;
    }

    thead {
      position: relative;
      z-index: 10;
    }

    /* Í≥†Ï†ï Ìó§Îçî ÏÉÅÎã® Ïò§Î≤ÑÎ†àÏù¥ */
    .fixed-header-overlay {
      position: fixed;
      top: 0;
      z-index: 99;
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      display: none;
    }

    /* Í≥†Ï†ï Ìó§Îçî Ïä§ÌÉÄÏùº */
    .fixed-header {
      position: fixed;
      top: 0;
      z-index: 100;
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-bottom: none;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      box-shadow: 0 8px 32px var(--glass-shadow);
      overflow: hidden;
    }

    .fixed-header table {
      margin: 0;
    }

    .fixed-header th {
      background: transparent;
    }

    thead tr {
      background: transparent;
    }

    th {
      background: transparent;
      font-weight: 600;
      font-size: var(--font-size-xs);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      border-bottom: none;
      transition: all var(--transition-normal);
      padding: var(--space-lg) var(--space-sm) var(--space-md);
      position: relative;
    }

    th::before {
      content: '';
      position: absolute;
      top: var(--space-md);
      bottom: 6px;
      left: 2px;
      right: 2px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      z-index: -1;
      transition: all var(--transition-normal);
    }

    th[data-sort] {
      cursor: pointer;
      user-select: none;
    }

    th[data-sort]:hover::before {
      background: var(--btn-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border-color: var(--btn-glass-border);
      box-shadow:
        0 2px 8px var(--glass-shadow),
        inset 0 1px 0 var(--glass-highlight);
    }

    th[data-sort]:hover {
      color: var(--text-primary);
    }

    th.sorted {
      color: var(--accent);
    }

    th.sorted::before {
      background: var(--active-glass-bg);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border-color: var(--active-glass-border);
      box-shadow:
        0 2px 10px var(--accent-glow),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }

    th .sort-icon {
      display: inline-block;
      margin-left: var(--space-xs);
      opacity: 0.5;
      transition: all var(--transition-fast);
    }

    th.sorted .sort-icon {
      opacity: 1;
    }

    th.sorted.desc .sort-icon {
      transform: rotate(180deg);
    }

    td {
      background: transparent;
      border-bottom: 1px solid var(--glass-border);
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
    }

    tbody tr {
      transition: all var(--transition-fast);
    }

    tbody tr:hover td {
      background: var(--glass-bg-hover);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    .player-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Team Badge - Glass Pill */
    .team-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--font-size-xs);
      font-weight: 600;
      backdrop-filter: blur(8px) saturate(140%);
      -webkit-backdrop-filter: blur(8px) saturate(140%);
      border: 1px solid var(--btn-glass-border);
    }

    .team-A {
      background: var(--team-a-bg);
      color: var(--team-a);
    }
    .team-B {
      background: var(--team-b-bg);
      color: var(--team-b);
    }
    .team-C {
      background: var(--team-c-bg);
      color: var(--team-c);
    }

    .highlight {
      color: var(--accent);
      font-weight: 600;
    }

    /* Rank Medals */
    .rank {
      font-weight: 700;
      color: var(--text-secondary);
    }

    .rank-1 {
      color: var(--medal-gold);
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    .rank-2 {
      color: var(--medal-silver);
      text-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
    }
    .rank-3 {
      color: var(--medal-bronze);
      text-shadow: 0 0 10px rgba(205, 127, 50, 0.5);
    }

    /* ===== Chat FAB ===== */
    .chat-fab {
      position: fixed;
      bottom: var(--space-lg);
      right: var(--space-lg);
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      cursor: pointer;
      box-shadow:
        0 8px 32px var(--accent-glow),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transition: all var(--transition-normal);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse-glow 3s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 8px 32px var(--accent-glow); }
      50% { box-shadow: 0 8px 48px var(--accent-glow), 0 0 60px var(--accent-glow); }
    }

    .chat-fab:hover {
      transform: scale(1.1);
      animation: none;
      box-shadow: 0 12px 48px var(--accent-glow);
    }

    .chat-fab svg {
      color: white;
      width: 28px;
      height: 28px;
    }

    /* ===== Chat Modal ===== */
    .chat-modal {
      position: fixed;
      bottom: 100px;
      right: var(--space-lg);
      width: 420px;
      max-width: calc(100vw - 48px);
      height: 550px;
      max-height: calc(100vh - 150px);
      display: none;
      flex-direction: column;
      z-index: 1001;
      overflow: hidden;
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      box-shadow: 0 16px 48px var(--glass-shadow);
    }

    .chat-modal.open {
      display: flex;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .chat-header {
      padding: var(--space-md) var(--space-lg);
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header h3 {
      font-size: var(--font-size-md);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .chat-header h3 svg {
      color: var(--accent);
    }

    .close-btn {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: var(--text-secondary);
      cursor: pointer;
      padding: var(--space-sm);
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-btn:hover {
      background: var(--glass-bg-hover);
      color: var(--text-primary);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-md);
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .message {
      max-width: 90%;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      line-height: 1.5;
      word-break: break-word;
      overflow-wrap: break-word;
    }

    .message.user {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      color: white;
      border-bottom-right-radius: var(--space-xs);
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    .message.ai {
      align-self: flex-start;
      background: var(--glass-bg-hover);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      color: var(--text-primary);
      border-bottom-left-radius: var(--space-xs);
    }

    /* AI Î©îÏãúÏßÄ ÎßàÌÅ¨Îã§Ïö¥ Ïä§ÌÉÄÏùº */
    .message.ai p {
      margin: 0 0 8px 0;
    }

    .message.ai p:last-child {
      margin-bottom: 0;
    }

    .message.ai strong {
      color: var(--accent);
      font-weight: 600;
    }

    .message.ai ul, .message.ai ol {
      margin: 8px 0;
      padding-left: 20px;
    }

    .message.ai li {
      margin: 4px 0;
    }

    .message.ai .table-wrapper {
      overflow-x: auto;
      margin: 12px 0;
      border-radius: 8px;
      -webkit-overflow-scrolling: touch;
    }

    .message.ai table {
      width: 100%;
      min-width: 100%;
      border-collapse: collapse;
      font-size: var(--font-size-xs);
      white-space: nowrap;
    }

    .message.ai th, .message.ai td {
      padding: var(--space-xs) var(--space-sm);
      text-align: left;
      border: 1px solid var(--glass-border);
    }

    .message.ai th {
      background: var(--glass-bg);
      font-weight: 600;
      color: var(--accent);
      font-size: var(--font-size-xs);
    }

    .message.ai td:first-child {
      font-weight: 600;
      color: var(--text-secondary);
    }

    .message.ai tr:hover td {
      background: rgba(255, 107, 53, 0.05);
    }

    /* ÌÖåÏù¥Î∏î Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùº */
    .message.ai .table-wrapper::-webkit-scrollbar {
      height: 4px;
    }

    .message.ai .table-wrapper::-webkit-scrollbar-track {
      background: var(--bg-hover);
      border-radius: 2px;
    }

    .message.ai .table-wrapper::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 2px;
    }

    /* Î™®Î∞îÏùºÏóêÏÑú ÌÖåÏù¥Î∏î ÏµúÏ†ÅÌôî */
    @media (max-width: 480px) {
      .message.ai table {
        font-size: 0.72rem;
      }

      .message.ai th, .message.ai td {
        padding: 4px 5px;
      }

      .message.ai th {
        font-size: 0.7rem;
      }
    }

    .message.ai h3, .message.ai h4 {
      margin: 12px 0 8px 0;
      color: var(--accent);
      font-weight: 600;
    }

    .message.ai h3:first-child, .message.ai h4:first-child {
      margin-top: 0;
    }

    .message.ai code {
      background: var(--bg-hover);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.85em;
    }

    .message.ai hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 12px 0;
    }

    .message.ai .highlight-value {
      color: var(--accent);
      font-weight: 600;
    }

    .message.system {
      align-self: center;
      background: transparent;
      color: var(--text-muted);
      font-size: var(--font-size-xs);
      text-align: center;
      padding: var(--space-sm);
    }

    .chat-input-area {
      padding: var(--space-md);
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid var(--glass-border);
      display: flex;
      gap: var(--space-sm);
    }

    .chat-input-area input {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      background: var(--glass-bg-hover);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
    }

    .chat-input-area input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-glow);
    }

    .chat-input-area input::placeholder {
      color: var(--text-muted);
    }

    .send-btn {
      padding: var(--space-sm) var(--space-md);
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ===== Team View Button ===== */
    .team-view-btn {
      cursor: pointer;
      transition: all var(--transition-normal);
      font-family: inherit;
      position: relative;
      overflow: visible;
      border: none;
    }

    .team-view-btn .stat-value {
      color: #ffffff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .team-view-btn .stat-label {
      color: rgba(255, 255, 255, 0.9);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .team-view-btn::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: calc(var(--radius-md) + 2px);
      background: linear-gradient(90deg,
        var(--team-a), var(--team-b), var(--team-c), var(--team-a));
      background-size: 300% 100%;
      animation: gradientFlow 3s linear infinite;
      z-index: -1;
    }

    .team-view-btn::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: var(--radius-md);
      background: var(--btn-glass-bg);
      z-index: -1;
    }

    @keyframes gradientFlow {
      0% { background-position: 0% 50%; }
      100% { background-position: 300% 50%; }
    }

    .team-view-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
    }

    .team-view-btn:hover::after {
      background: var(--glass-bg-hover);
    }

    .team-view-btn:active {
      transform: translateY(0);
    }

    /* ===== Team Modal ===== */
    .team-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: var(--space-lg);
    }

    .team-modal.open {
      display: flex;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .team-modal-content {
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      width: fit-content;
      max-width: calc(100vw - 32px);
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 16px 48px var(--glass-shadow);
    }

    .team-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }

    .team-modal-header h3 {
      font-size: var(--font-size-lg);
      font-weight: 600;
    }

    .team-modal-header .close-btn {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: var(--space-xs);
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
    }

    .team-modal-header .close-btn:hover {
      color: var(--text-primary);
      background: var(--btn-glass-bg-hover);
    }

    .team-tabs {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-md);
    }

    .team-tab {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      background: var(--btn-glass-bg);
      border: 1px solid var(--btn-glass-border);
      border-radius: var(--radius-full);
      color: var(--text-secondary);
      font-size: var(--font-size-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      font-family: inherit;
    }

    .team-tab:hover {
      background: var(--btn-glass-bg-hover);
      color: var(--text-primary);
    }

    .team-tab.active {
      background: var(--active-glass-bg);
      border-color: var(--active-glass-border);
      color: var(--accent);
    }

    .team-tab[data-team="A"].active {
      background: rgba(59, 130, 246, 0.15);
      border-color: rgba(59, 130, 246, 0.3);
      color: var(--team-a);
    }

    .team-tab[data-team="B"].active {
      background: rgba(34, 197, 94, 0.15);
      border-color: rgba(34, 197, 94, 0.3);
      color: var(--team-b);
    }

    .team-tab[data-team="C"].active {
      background: rgba(245, 158, 11, 0.15);
      border-color: rgba(245, 158, 11, 0.3);
      color: var(--team-c);
    }

    .team-table-container {
      overflow: auto;
      flex: 1;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    /* Î™®Îã¨ Ïó¥Î¶¥ Îïå body Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ */
    body.modal-open {
      overflow: hidden;
      position: fixed;
      width: 100%;
    }

    .team-table {
      width: 500px;
      min-width: 500px;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .team-table th,
    .team-table td {
      padding: 12px 10px;
      text-align: center;
      border-bottom: 1px solid var(--glass-border);
      font-size: 15px;
    }

    .team-table th:nth-child(1) { width: 80px; }
    .team-table th:nth-child(2) { width: 150px; }
    .team-table th:nth-child(3) { width: 80px; }
    .team-table th:nth-child(4) { width: 120px; }

    .team-table th {
      font-weight: 600;
      color: var(--text-secondary);
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      position: sticky;
      top: 0;
      z-index: 1;
      font-size: 11px;
    }

    .team-table td {
      color: var(--text-primary);
    }

    .team-table tbody tr:hover {
      background: var(--btn-glass-bg-hover);
    }

    .team-table td:last-child {
      font-weight: 600;
      color: var(--accent);
    }

    /* ===== API Key Modal ===== */
    .api-key-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: var(--space-lg);
    }

    .api-key-modal.open {
      display: flex;
    }

    .api-key-content {
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      max-width: 420px;
      width: 100%;
      box-shadow: 0 16px 48px var(--glass-shadow);
    }

    .api-key-content h3 {
      margin-bottom: var(--space-sm);
      font-size: var(--font-size-lg);
    }

    .api-key-content p {
      color: var(--text-secondary);
      margin-bottom: var(--space-lg);
      font-size: var(--font-size-sm);
    }

    .api-key-content input {
      width: 100%;
      padding: var(--space-md);
      background: var(--glass-bg-hover);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: var(--font-size-md);
      margin-bottom: var(--space-md);
      transition: all var(--transition-fast);
    }

    .api-key-content input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .api-key-buttons {
      display: flex;
      gap: var(--space-sm);
      justify-content: flex-end;
    }

    .btn-secondary {
      padding: var(--space-sm) var(--space-lg);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      cursor: pointer;
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
    }

    .btn-secondary:hover {
      background: var(--glass-bg-hover);
    }

    .btn-primary {
      padding: var(--space-sm) var(--space-lg);
      background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      cursor: pointer;
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    /* ===== Typing Indicator ===== */
    .typing-indicator {
      display: flex;
      gap: var(--space-xs);
      padding: var(--space-sm) var(--space-md);
      background: var(--glass-bg-hover);
      border-radius: var(--radius-md);
      width: fit-content;
      border: 1px solid var(--glass-border);
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: var(--text-muted);
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }

    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .container {
        padding: var(--space-md);
      }

      .theme-toggle {
        top: var(--space-md);
        right: var(--space-md);
      }

      header {
        padding: var(--space-lg) var(--space-md);
      }

      header h1 {
        font-size: var(--font-size-xl);
      }

      .stats-summary {
        gap: var(--space-sm);
        flex-wrap: nowrap;
      }

      .stat-item {
        padding: var(--space-sm) var(--space-md);
        min-width: auto;
        flex: 1;
      }

      .stat-value {
        font-size: var(--font-size-md);
      }

      .stat-label {
        font-size: 10px;
        letter-spacing: 0.5px;
      }

      .controls {
        flex-direction: column;
      }

      .search-box {
        width: 100%;
      }

      .chat-modal {
        bottom: 0;
        right: 0;
        width: 100%;
        max-width: 100%;
        height: calc(100dvh - 80px);
        max-height: calc(100dvh - 80px);
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      }

      .team-table {
        width: 100%;
        min-width: 260px;
      }

      .team-table th,
      .team-table td {
        padding: 8px 4px;
        font-size: 13px;
      }

      .team-table th:nth-child(1) { width: 50px; }
      .team-table th:nth-child(2) { width: 80px; }
      .team-table th:nth-child(3) { width: 50px; }
      .team-table th:nth-child(4) { width: 100px; }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state svg {
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* ===== Scrollbar ===== */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--glass-bg);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--glass-border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }
  </style>
</head>
<body>
  <!-- Background -->
  <div class="bg-image"></div>
  <div class="bg-mesh"></div>

  <!-- Theme Toggle -->
  <div class="theme-toggle">
    <button class="theme-btn" id="themeToggle" title="Toggle theme">
      <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
      <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    </button>
  </div>

  <div class="container">
    <header class="glass">
      <h1>ÎÇòÏù∏Î∏îÎ°úÏª§Ïä§ Î¶¨Í∑∏</h1>
      <p>2025ÎÖÑ 8Ïõî ÏãúÏ¶å ÏÑ†Ïàò ÌÜµÍ≥Ñ</p>
      <div class="stats-summary">
        <div class="stat-item">
          <div class="stat-value" id="totalRounds">12</div>
          <div class="stat-label">Ï¥ù ÎùºÏö¥Îìú</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalPlayers">42</div>
          <div class="stat-label">Ï∞∏Í∞Ä ÏÑ†Ïàò</div>
        </div>
        <button class="stat-item team-view-btn" id="teamViewBtn">
          <div class="stat-value" id="totalTeams">3</div>
          <div class="stat-label">ÌåÄ Î≥¥Í∏∞</div>
        </button>
      </div>

      <!-- ÌåÄ ÏàúÏúÑ Î∞è Ïñ¥ÏõåÎìú (Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ÏóêÏÑú ÎèôÏ†Å Î°úÎî©) -->
      <div class="league-info" id="leagueInfo" style="display: none;">
        <div class="current-round-row">
          <div class="current-round-badge" id="currentRoundBadge">
            <span class="round-label">ÌòÑÏû¨</span>
            <span class="round-value" id="currentRoundValue">1</span>
            <span class="round-total">/ 15 ÎùºÏö¥Îìú</span>
          </div>
        </div>
        <div class="standings-row">
          <div class="standing-item" id="standing1">
            <span class="standing-rank">1ÏúÑ</span>
            <span class="standing-team team-badge team-C">CÌåÄ</span>
            <span class="standing-record">2Ïäπ 0Ìå®</span>
            <span class="standing-points">6Ï†ê</span>
          </div>
          <div class="standing-item" id="standing2">
            <span class="standing-rank">2ÏúÑ</span>
            <span class="standing-team team-badge team-A">AÌåÄ</span>
            <span class="standing-record">1Ïäπ 1Ìå®</span>
            <span class="standing-points">3Ï†ê</span>
          </div>
          <div class="standing-item" id="standing3">
            <span class="standing-rank">3ÏúÑ</span>
            <span class="standing-team team-badge team-B">BÌåÄ</span>
            <span class="standing-record">0Ïäπ 2Ìå®</span>
            <span class="standing-points">1Ï†ê</span>
          </div>
        </div>
        <div class="awards-row" id="awardsRow">
          <div class="award-item">
            <span class="award-icon">üëë</span>
            <span class="award-label">MOM</span>
            <span class="award-value" id="awardMom">Í∂åÏù∏Ìöå</span>
          </div>
          <div class="award-item">
            <span class="award-icon">‚úåÔ∏è</span>
            <span class="award-label">ÎçîÎ∏îÎçîÎ∏î</span>
            <span class="award-value" id="awardDD">Ïù¥ÏäπÌòÑ</span>
          </div>
          <div class="award-item">
            <span class="award-icon">üèÄ</span>
            <span class="award-label">ÎìùÏ†êÏôï</span>
            <span class="award-value" id="awardScorer">Í∞ïÏû¨Ìõà(66Ï†ê)</span>
          </div>
        </div>
        <div class="excel-link-row">
          <a href="https://docs.google.com/spreadsheets/d/1sZtdJ9ErOeu4UuOQqHI9ganqCD4ZuP2ETr904emxnfQ/edit?usp=sharing" target="_blank" class="excel-link-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
            ÏõêÎ≥∏ ÏóëÏÖÄ Î∞îÎ°úÍ∞ÄÍ∏∞
          </a>
        </div>
      </div>
    </header>

    <div class="controls">
      <div class="toggle-group" id="seasonSelector">
        <button class="toggle-btn" data-season="202402">2024ÎÖÑ 2Ïõî</button>
        <button class="toggle-btn" data-season="202409">2024ÎÖÑ 9Ïõî</button>
        <button class="toggle-btn" data-season="202508">2025ÎÖÑ 8Ïõî</button>
        <button class="toggle-btn active" data-season="202601">2026ÎÖÑ 1Ïõî</button>
      </div>
      <div class="search-box">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" id="searchInput" placeholder="ÏÑ†Ïàò Ïù¥Î¶ÑÏúºÎ°ú Í≤ÄÏÉâ...">
      </div>
    </div>

    <div class="table-wrapper glass">
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>ÏàúÏúÑ</th>
              <th data-sort="Î≤àÌò∏">Î≤àÌò∏<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÌåÄ">ÌåÄ<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÏÑ†ÏàòÎ™Ö">ÏÑ†ÏàòÎ™Ö<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="Ï∂úÏÑù">Ï∂úÏÑù<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÎàÑÏ†ÅÎìùÏ†ê" class="sorted desc">ÎàÑÏ†ÅÎìùÏ†ê<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÌèâÍ∑†ÎìùÏ†ê">ÌèâÍ∑†ÎìùÏ†ê<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÎàÑÏ†ÅÏñ¥Ïãú">ÎàÑÏ†ÅÏñ¥Ïãú<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÌèâÍ∑†Ïñ¥Ïãú">ÌèâÍ∑†Ïñ¥Ïãú<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÎàÑÏ†ÅÎ¶¨Î∞î">ÎàÑÏ†ÅÎ¶¨Î∞î<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÌèâÍ∑†Î¶¨Î∞î">ÌèâÍ∑†Î¶¨Î∞î<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÎàÑÏ†ÅÏä§Ìã∏">ÎàÑÏ†ÅÏä§Ìã∏<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÌèâÍ∑†Ïä§Ìã∏">ÌèâÍ∑†Ïä§Ìã∏<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÎàÑÏ†ÅÎ∏îÎ°ù">ÎàÑÏ†ÅÎ∏îÎ°ù<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÌèâÍ∑†Î∏îÎ°ù">ÌèâÍ∑†Î∏îÎ°ù<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÎàÑÏ†Å3Ï†ê">ÎàÑÏ†Å3Ï†ê<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
              <th data-sort="ÌèâÍ∑†3Ï†ê">ÌèâÍ∑†3Ï†ê<span class="sort-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg></span></th>
            </tr>
          </thead>
          <tbody id="tableBody">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Chat FAB -->
  <button class="chat-fab" id="chatFab" title="AIÏóêÍ≤å ÏßàÎ¨∏ÌïòÍ∏∞">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
  </button>

  <!-- Chat Modal -->
  <div class="chat-modal" id="chatModal">
    <div class="chat-header">
      <h3>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        Î¶¨Í∑∏ ÌÜµÍ≥Ñ AI
      </h3>
      <button class="close-btn" id="closeChat">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="message system">
        ÎÇòÏù∏Î∏îÎ°úÏª§Ïä§ Î¶¨Í∑∏ ÌÜµÍ≥ÑÏóê ÎåÄÌï¥ Î¨¥ÏóáÏù¥Îì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî!
      </div>
    </div>
    <div class="chat-input-area">
      <input type="text" id="chatInput" placeholder="ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." autocomplete="off">
      <button class="send-btn" id="sendBtn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
  </div>

  <!-- Team Modal -->
  <div class="team-modal" id="teamModal">
    <div class="team-modal-content">
      <div class="team-modal-header">
        <h3>ÌåÄ Ï†ïÎ≥¥</h3>
        <button class="close-btn" id="closeTeamModal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="team-tabs">
        <button class="team-tab active" data-team="A">AÌåÄ</button>
        <button class="team-tab" data-team="B">BÌåÄ</button>
        <button class="team-tab" data-team="C">CÌåÄ</button>
      </div>
      <div class="team-table-container">
        <table class="team-table">
          <thead>
            <tr>
              <th>Î≤àÌò∏</th>
              <th>Ïù¥Î¶Ñ</th>
              <th>Ï∂úÏÑù</th>
              <th>ÎàÑÏ†ÅÎìùÏ†ê</th>
            </tr>
          </thead>
          <tbody id="teamTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- API Key Modal -->
  <div class="api-key-modal" id="apiKeyModal">
    <div class="api-key-content">
      <h3>üîë Gemini API ÌÇ§ ÏûÖÎ†•</h3>
      <p>AI Ï±ÑÌåÖ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ Google Gemini API ÌÇ§Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§. ÌÇ§Îäî Î∏åÎùºÏö∞Ï†ÄÏóê ÏïàÏ†ÑÌïòÍ≤å Ï†ÄÏû•Îê©ÎãàÎã§.</p>
      <input type="password" id="apiKeyInput" placeholder="API ÌÇ§Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
      <div class="api-key-buttons">
        <button class="btn-secondary" id="cancelApiKey">Ï∑®ÏÜå</button>
        <button class="btn-primary" id="saveApiKey">Ï†ÄÏû•</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // ÏãúÏ¶å Î™©Î°ù (ÏÉà ÏãúÏ¶å Ï∂îÍ∞Ä Ïãú Î∞∞Ïó¥ ÏïûÏóê Ï∂îÍ∞Ä)
    const SEASONS = ['202601', '202508', '202409', '202402'];

    // JSON Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ìï®Ïàò
    async function loadSeasonData(seasonId) {
      const response = await fetch(`league_stats_${seasonId}.json`);
      if (!response.ok) {
        throw new Error(`Failed to load season ${seasonId}`);
      }
      return await response.json();
    }

    async function loadAllSeasons() {
      const data = {};
      await Promise.all(SEASONS.map(async (seasonId) => {
        data[seasonId] = await loadSeasonData(seasonId);
      }));
      return data;
    }

    // Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Î°úÎî© Ìï®Ïàò
    async function loadSeasonMetadata(seasonId) {
      try {
        const response = await fetch(`league_metadata_${seasonId}.json`);
        if (!response.ok) return null;
        return await response.json();
      } catch (e) {
        return null;
      }
    }

    async function loadAllMetadata() {
      const data = {};
      await Promise.all(SEASONS.map(async (seasonId) => {
        data[seasonId] = await loadSeasonMetadata(seasonId);
      }));
      return data;
    }

    // ÏãúÏ¶åÎ≥Ñ Îç∞Ïù¥ÌÑ∞ (JSON ÌååÏùºÏóêÏÑú ÎèôÏ†Å Î°úÎî©)
    let seasonsData = {};
    let metadataCache = {};

    // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÏãúÏ¶å Îç∞Ïù¥ÌÑ∞
    let currentSeason = '202601';
    let leagueData = seasonsData[currentSeason];

    // ÏãúÏ¶å Ï†ÑÌôò Ìï®Ïàò
    function switchSeason(season) {
      if (season === currentSeason) return;

      currentSeason = season;
      leagueData = seasonsData[season];

      // UI ÏóÖÎç∞Ïù¥Ìä∏
      updateHeader();
      renderTable();

      // ÏãúÏ¶å Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
      document.querySelectorAll('#seasonSelector .toggle-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.season === season);
      });

      // AI Ï±ÑÌåÖ ÌûàÏä§ÌÜ†Î¶¨ Ï¥àÍ∏∞Ìôî (ÏãúÏ¶å Î≥ÄÍ≤ΩÏãú)
      chatHistory = [];
    }

    // Ìó§Îçî Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
    function updateHeader() {
      document.title = `ÎÇòÏù∏Î∏îÎ°úÏª§Ïä§ Î¶¨Í∑∏ - ${leagueData.ÏãúÏ¶å} ÏãúÏ¶å`;
      document.querySelector('header p').textContent = `${leagueData.ÏãúÏ¶å} ÏãúÏ¶å ÏÑ†Ïàò ÌÜµÍ≥Ñ`;
      document.getElementById('totalRounds').textContent = leagueData.Ï¥ùÎùºÏö¥Îìú;
      document.getElementById('totalPlayers').textContent = leagueData.Ï¥ùÏÑ†ÏàòÏàò;

      // Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ ÌëúÏãú
      updateLeagueInfo();
    }

    // Î¶¨Í∑∏ Ï†ïÎ≥¥(ÏàúÏúÑ, Ïñ¥ÏõåÎìú) ÏóÖÎç∞Ïù¥Ìä∏
    function updateLeagueInfo() {
      const metadata = metadataCache[currentSeason];
      const leagueInfo = document.getElementById('leagueInfo');

      if (!metadata) {
        if (leagueInfo) leagueInfo.style.display = 'none';
        return;
      }

      if (leagueInfo) leagueInfo.style.display = 'block';

      // ÌòÑÏû¨ ÎùºÏö¥Îìú ÌëúÏãú
      const currentRoundValue = document.getElementById('currentRoundValue');
      const roundTotalEl = document.querySelector('.round-total');
      if (currentRoundValue) {
        currentRoundValue.textContent = metadata.currentRound || 1;
      }
      if (roundTotalEl) {
        roundTotalEl.textContent = `/ ${metadata.totalRounds || 15} ÎùºÏö¥Îìú`;
      }

      // ÌåÄ ÏàúÏúÑ ÌëúÏãú
      const standings = metadata.standings || [];
      for (let i = 0; i < 3; i++) {
        const standingEl = document.getElementById(`standing${i + 1}`);
        if (standingEl && standings[i]) {
          const team = standings[i];
          const record = `${team.wins}Ïäπ ${team.losses}Ìå®`;
          standingEl.querySelector('.standing-team').textContent = team.name;
          standingEl.querySelector('.standing-team').className = `standing-team team-badge team-${team.team}`;
          standingEl.querySelector('.standing-record').textContent = record;
          standingEl.querySelector('.standing-points').textContent = `${team.points}Ï†ê`;
        }
      }

      // ÏµúÏã† ÎùºÏö¥ÎìúÏùò Ïñ¥ÏõåÎìú ÌëúÏãú
      const roundHistory = metadata.roundHistory || [];
      const latestRound = roundHistory[roundHistory.length - 1];
      const awardsRow = document.getElementById('awardsRow');

      if (latestRound && latestRound.awards) {
        awardsRow.style.display = 'flex';
        const awards = latestRound.awards;

        // MOM
        const momEl = document.getElementById('awardMom');
        if (momEl && awards.mom) {
          momEl.textContent = awards.mom;
        } else if (momEl) {
          momEl.textContent = '-';
        }

        // ÎçîÎ∏îÎçîÎ∏î
        const ddEl = document.getElementById('awardDD');
        if (ddEl && awards.doubleDouble) {
          ddEl.textContent = awards.doubleDouble;
        } else if (ddEl) {
          ddEl.textContent = '-';
        }

        // ÎìùÏ†êÏôï
        const scorerEl = document.getElementById('awardScorer');
        if (scorerEl && awards.topScorer) {
          scorerEl.textContent = `${awards.topScorer.name}(${awards.topScorer.points}Ï†ê)`;
        } else if (scorerEl) {
          scorerEl.textContent = '-';
        }
      } else {
        awardsRow.style.display = 'none';
      }
    }

    // ÏÉÅÌÉú Í¥ÄÎ¶¨
    let currentSort = { field: 'ÎàÑÏ†ÅÎìùÏ†ê', order: 'desc' };
    let searchQuery = '';
    let apiKey = localStorage.getItem('gemini_api_key') || '';
    let genAI = null;
    let chatHistory = [];

    // DOM ÏöîÏÜå
    const tableBody = document.getElementById('tableBody');
    const searchInput = document.getElementById('searchInput');
    const chatFab = document.getElementById('chatFab');
    const chatModal = document.getElementById('chatModal');
    const closeChat = document.getElementById('closeChat');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const apiKeyModal = document.getElementById('apiKeyModal');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const saveApiKey = document.getElementById('saveApiKey');
    const cancelApiKey = document.getElementById('cancelApiKey');
    const themeToggle = document.getElementById('themeToggle');
    const teamViewBtn = document.getElementById('teamViewBtn');
    const teamModal = document.getElementById('teamModal');
    const closeTeamModal = document.getElementById('closeTeamModal');
    const teamTabs = document.querySelectorAll('.team-tab');
    const teamTableBody = document.getElementById('teamTableBody');

    // ÌÖåÎßà ÌÜ†Í∏Ä Í∏∞Îä•
    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
    }

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }

    themeToggle.addEventListener('click', toggleTheme);
    initTheme();

    // Îç∞Ïù¥ÌÑ∞ Í∞ÄÍ≥µ Ìï®Ïàò
    function getPlayerValue(player, field) {
      switch (field) {
        case 'Î≤àÌò∏': return player.Î≤àÌò∏;
        case 'ÌåÄ': return player.ÌåÄ;
        case 'ÏÑ†ÏàòÎ™Ö': return player.ÏÑ†ÏàòÎ™Ö;
        case 'Ï∂úÏÑù': return player.Ï∂úÏÑù;
        case 'ÎàÑÏ†ÅÎìùÏ†ê': return player.ÎìùÏ†ê.ÎàÑÏ†ÅÎìùÏ†ê;
        case 'ÌèâÍ∑†ÎìùÏ†ê': return player.ÎìùÏ†ê.ÌèâÍ∑†ÎìùÏ†ê;
        case 'ÎàÑÏ†ÅÏñ¥Ïãú': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïñ¥ÏãúÏä§Ìä∏.ÎàÑÏ†Å;
        case 'ÌèâÍ∑†Ïñ¥Ïãú': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïñ¥ÏãúÏä§Ìä∏.ÌèâÍ∑†;
        case 'ÎàÑÏ†ÅÎ¶¨Î∞î': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î¶¨Î∞îÏö¥Îìú.ÎàÑÏ†Å;
        case 'ÌèâÍ∑†Î¶¨Î∞î': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î¶¨Î∞îÏö¥Îìú.ÌèâÍ∑†;
        case 'ÎàÑÏ†ÅÏä§Ìã∏': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïä§Ìã∏.ÎàÑÏ†Å;
        case 'ÌèâÍ∑†Ïä§Ìã∏': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïä§Ìã∏.ÌèâÍ∑†;
        case 'ÎàÑÏ†ÅÎ∏îÎ°ù': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î∏îÎ°ù.ÎàÑÏ†Å;
        case 'ÌèâÍ∑†Î∏îÎ°ù': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î∏îÎ°ù.ÌèâÍ∑†;
        case 'ÎàÑÏ†Å3Ï†ê': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù['3Ï†êÏäõ'].ÎàÑÏ†Å;
        case 'ÌèâÍ∑†3Ï†ê': return player.Î∂ÄÍ∞ÄÍ∏∞Î°ù['3Ï†êÏäõ'].ÌèâÍ∑†;
        default: return 0;
      }
    }

    // Ï†ïÎ†¨Îêú Ï†ÑÏ≤¥ ÏÑ†Ïàò Î™©Î°ù Î∞òÌôò
    function getSortedPlayers() {
      let players = [...leagueData.ÏÑ†ÏàòÎ™©Î°ù];
      
      // Ï†ïÎ†¨
      players.sort((a, b) => {
        const aVal = getPlayerValue(a, currentSort.field);
        const bVal = getPlayerValue(b, currentSort.field);
        
        if (typeof aVal === 'string') {
          return currentSort.order === 'asc' 
            ? aVal.localeCompare(bVal) 
            : bVal.localeCompare(aVal);
        }
        
        return currentSort.order === 'asc' ? aVal - bVal : bVal - aVal;
      });
      
      return players;
    }

    // Í≤ÄÏÉâ ÌïÑÌÑ∞ÎßÅ Ï†ÅÏö©
    function getFilteredPlayers(sortedPlayers) {
      if (!searchQuery) {
        return sortedPlayers;
      }
      
      return sortedPlayers.filter(p => 
        p.ÏÑ†ÏàòÎ™Ö.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }

    // ÌòÑÏû¨ Ï†ïÎ†¨ Í∏∞Ï§ÄÏóê Îî∞Îùº highlight ÌÅ¥ÎûòÏä§ Î∞òÌôò
    function getHighlightClass(field) {
      return currentSort.field === field ? 'highlight' : '';
    }

    // ÌÖåÏù¥Î∏î Î†åÎçîÎßÅ
    function renderTable() {
      const sortedPlayers = getSortedPlayers();
      const filteredPlayers = getFilteredPlayers(sortedPlayers);
      
      // Ï†ïÎ†¨Îêú Ï†ÑÏ≤¥ Î™©Î°ùÏóêÏÑú Í∞Å ÏÑ†ÏàòÏùò ÏàúÏúÑ Îßµ ÏÉùÏÑ±
      const rankMap = new Map();
      sortedPlayers.forEach((player, index) => {
        rankMap.set(player.ÏÑ†ÏàòÎ™Ö, index + 1);
      });
      
      if (filteredPlayers.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="17">
              <div class="empty-state">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <p>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }
      
      tableBody.innerHTML = filteredPlayers.map(player => {
        const rank = rankMap.get(player.ÏÑ†ÏàòÎ™Ö);
        const rankClass = rank <= 3 ? `rank rank-${rank}` : 'rank';
        return `
        <tr>
          <td class="${rankClass}">${rank}</td>
          <td class="${getHighlightClass('Î≤àÌò∏')}">${player.Î≤àÌò∏}</td>
          <td class="${getHighlightClass('ÌåÄ')}"><span class="team-badge team-${player.ÌåÄ}">${player.ÌåÄ}</span></td>
          <td class="player-name ${getHighlightClass('ÏÑ†ÏàòÎ™Ö')}">${player.ÏÑ†ÏàòÎ™Ö}</td>
          <td class="${getHighlightClass('Ï∂úÏÑù')}">${player.Ï∂úÏÑù}</td>
          <td class="${getHighlightClass('ÎàÑÏ†ÅÎìùÏ†ê')}">${player.ÎìùÏ†ê.ÎàÑÏ†ÅÎìùÏ†ê}</td>
          <td class="${getHighlightClass('ÌèâÍ∑†ÎìùÏ†ê')}">${player.ÎìùÏ†ê.ÌèâÍ∑†ÎìùÏ†ê.toFixed(1)}</td>
          <td class="${getHighlightClass('ÎàÑÏ†ÅÏñ¥Ïãú')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïñ¥ÏãúÏä§Ìä∏.ÎàÑÏ†Å}</td>
          <td class="${getHighlightClass('ÌèâÍ∑†Ïñ¥Ïãú')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïñ¥ÏãúÏä§Ìä∏.ÌèâÍ∑†.toFixed(1)}</td>
          <td class="${getHighlightClass('ÎàÑÏ†ÅÎ¶¨Î∞î')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î¶¨Î∞îÏö¥Îìú.ÎàÑÏ†Å}</td>
          <td class="${getHighlightClass('ÌèâÍ∑†Î¶¨Î∞î')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î¶¨Î∞îÏö¥Îìú.ÌèâÍ∑†.toFixed(1)}</td>
          <td class="${getHighlightClass('ÎàÑÏ†ÅÏä§Ìã∏')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïä§Ìã∏.ÎàÑÏ†Å}</td>
          <td class="${getHighlightClass('ÌèâÍ∑†Ïä§Ìã∏')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïä§Ìã∏.ÌèâÍ∑†.toFixed(1)}</td>
          <td class="${getHighlightClass('ÎàÑÏ†ÅÎ∏îÎ°ù')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î∏îÎ°ù.ÎàÑÏ†Å}</td>
          <td class="${getHighlightClass('ÌèâÍ∑†Î∏îÎ°ù')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î∏îÎ°ù.ÌèâÍ∑†.toFixed(1)}</td>
          <td class="${getHighlightClass('ÎàÑÏ†Å3Ï†ê')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù['3Ï†êÏäõ'].ÎàÑÏ†Å}</td>
          <td class="${getHighlightClass('ÌèâÍ∑†3Ï†ê')}">${player.Î∂ÄÍ∞ÄÍ∏∞Î°ù['3Ï†êÏäõ'].ÌèâÍ∑†.toFixed(1)}</td>
        </tr>
      `;}).join('');
    }

    // Ï†ïÎ†¨ Ìó§Îçî ÏóÖÎç∞Ïù¥Ìä∏
    function updateSortHeaders() {
      document.querySelectorAll('th').forEach(th => {
        th.classList.remove('sorted', 'asc', 'desc');
        if (th.dataset.sort === currentSort.field) {
          th.classList.add('sorted', currentSort.order);
        }
      });
    }

    // Ï†ïÎ†¨ ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
    document.querySelectorAll('th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const field = th.dataset.sort;
        if (currentSort.field === field) {
          currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.field = field;
          currentSort.order = 'desc';
        }
        updateSortHeaders();
        renderTable();
      });
    });

    // Í≤ÄÏÉâ Ìï∏Îì§Îü¨
    searchInput.addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderTable();
    });

    // ÌåÄ Î™®Îã¨ Í∏∞Îä•
    function renderTeamTable(team) {
      const teamPlayers = leagueData.ÏÑ†ÏàòÎ™©Î°ù.filter(p => p.ÌåÄ === team);
      teamPlayers.sort((a, b) => a.Î≤àÌò∏ - b.Î≤àÌò∏);
      teamTableBody.innerHTML = teamPlayers.map(p => `
        <tr>
          <td>${p.Î≤àÌò∏}</td>
          <td>${p.ÏÑ†ÏàòÎ™Ö}</td>
          <td>${p.Ï∂úÏÑù}</td>
          <td>${p.ÎìùÏ†ê.ÎàÑÏ†ÅÎìùÏ†ê}</td>
        </tr>
      `).join('');
    }

    // Ïä§ÌÅ¨Î°§ ÏúÑÏπò Ï†ÄÏû• Î≥ÄÏàò
    let savedScrollPosition = 0;

    teamViewBtn.addEventListener('click', () => {
      savedScrollPosition = window.scrollY;
      document.body.style.top = `-${savedScrollPosition}px`;
      document.body.classList.add('modal-open');
      teamModal.classList.add('open');
      teamTabs.forEach(t => t.classList.remove('active'));
      teamTabs[0].classList.add('active');
      renderTeamTable('A');
    });

    function closeTeamModalHandler() {
      teamModal.classList.remove('open');
      document.body.classList.remove('modal-open');
      document.body.style.top = '';
      window.scrollTo(0, savedScrollPosition);
    }

    closeTeamModal.addEventListener('click', closeTeamModalHandler);

    teamModal.addEventListener('click', (e) => {
      if (e.target === teamModal) {
        closeTeamModalHandler();
      }
    });

    teamTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        teamTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        renderTeamTable(tab.dataset.team);
      });
    });

    // Ï±ÑÌåÖ Î™®Îã¨ ÌÜ†Í∏Ä
    chatFab.addEventListener('click', () => {
      if (!apiKey) {
        apiKeyModal.classList.add('open');
        return;
      }
      chatModal.classList.toggle('open');
    });

    closeChat.addEventListener('click', () => {
      chatModal.classList.remove('open');
    });

    // API ÌÇ§ Î™®Îã¨
    saveApiKey.addEventListener('click', () => {
      const key = apiKeyInput.value.trim();
      if (key) {
        apiKey = key;
        localStorage.setItem('gemini_api_key', key);
        initGemini();
        apiKeyModal.classList.remove('open');
        chatModal.classList.add('open');
        apiKeyInput.value = '';
      }
    });

    cancelApiKey.addEventListener('click', () => {
      apiKeyModal.classList.remove('open');
      apiKeyInput.value = '';
    });

    // Gemini Ï¥àÍ∏∞Ìôî
    function initGemini() {
      if (apiKey) {
        genAI = new GoogleGenerativeAI(apiKey);
      }
    }

    // ÏãúÏä§ÌÖú ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ±
    function getSystemPrompt() {
      const playersSummary = leagueData.ÏÑ†ÏàòÎ™©Î°ù.map(p =>
        `${p.ÏÑ†ÏàòÎ™Ö}(#${p.Î≤àÌò∏}, ÌåÄ${p.ÌåÄ}): ÎìùÏ†ê ${p.ÎìùÏ†ê.ÌèâÍ∑†ÎìùÏ†ê}(ÌèâÍ∑†)/${p.ÎìùÏ†ê.ÎàÑÏ†ÅÎìùÏ†ê}(ÎàÑÏ†Å), ` +
        `Ïñ¥ÏãúÏä§Ìä∏ ${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïñ¥ÏãúÏä§Ìä∏.ÌèâÍ∑†}/${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïñ¥ÏãúÏä§Ìä∏.ÎàÑÏ†Å}, ` +
        `Î¶¨Î∞îÏö¥Îìú ${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î¶¨Î∞îÏö¥Îìú.ÌèâÍ∑†}/${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î¶¨Î∞îÏö¥Îìú.ÎàÑÏ†Å}, ` +
        `Ïä§Ìã∏ ${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïä§Ìã∏.ÌèâÍ∑†}/${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Ïä§Ìã∏.ÎàÑÏ†Å}, ` +
        `Î∏îÎ°ù ${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î∏îÎ°ù.ÌèâÍ∑†}/${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù.Î∏îÎ°ù.ÎàÑÏ†Å}, ` +
        `3Ï†êÏäõ ${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù['3Ï†êÏäõ'].ÌèâÍ∑†}/${p.Î∂ÄÍ∞ÄÍ∏∞Î°ù['3Ï†êÏäõ'].ÎàÑÏ†Å}, ` +
        `Ï∂úÏÑù ${p.Ï∂úÏÑù}Í≤ΩÍ∏∞`
      ).join('\n');

      return `ÎãπÏã†ÏùÄ "ÎÇòÏù∏Î∏îÎ°úÏª§Ïä§" ÎÜçÍµ¨ Î¶¨Í∑∏Ïùò Í≥µÏãù ÌÜµÍ≥Ñ Î∂ÑÏÑù AIÏûÖÎãàÎã§.

## ÏãúÏ¶å Ï†ïÎ≥¥
- ÏãúÏ¶å: ${leagueData.ÏãúÏ¶å}
- Ï¥ù ÎùºÏö¥Îìú: ${leagueData.Ï¥ùÎùºÏö¥Îìú}
- Ï¥ù ÏÑ†Ïàò: ${leagueData.Ï¥ùÏÑ†ÏàòÏàò}Î™Ö
- ÌåÄ: A, B, C

## ÏÑ†Ïàò Îç∞Ïù¥ÌÑ∞ (Ïù¥Î¶Ñ, Î≤àÌò∏, ÌåÄ, ÌèâÍ∑†/ÎàÑÏ†Å Í∏∞Î°ù)
${playersSummary}

## ÎãπÏã†Ïùò Ïó≠Ìï†
1. ÏúÑ ÏÑ†Ïàò Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Î∞òÏúºÎ°ú ÏßàÎ¨∏Ïóê Ï†ïÌôïÌïòÍ≤å ÎãµÎ≥ÄÌï©ÎãàÎã§.
2. ÎìùÏ†êÏôï, Ïñ¥ÏãúÏä§Ìä∏Ïôï, Î¶¨Î∞îÏö¥ÎìúÏôï Îì± Í∞Å Î∂ÄÎ¨∏Î≥Ñ 1ÏúÑÎ•º Ï∞æÏïÑÏ§Ñ Ïàò ÏûàÏäµÎãàÎã§.
3. ÌäπÏ†ï ÏÑ†ÏàòÏùò Í∏∞Î°ùÏùÑ ÏïåÎ†§Ï§Ñ Ïàò ÏûàÏäµÎãàÎã§.
4. ÌåÄÎ≥Ñ ÌÜµÍ≥Ñ ÎπÑÍµêÎ•º Ìï¥Ï§Ñ Ïàò ÏûàÏäµÎãàÎã§.
5. ÏÑ†ÏàòÎì§Ïùò Í∞ïÏ†êÍ≥º ÏïΩÏ†êÏùÑ Î∂ÑÏÑùÌï¥Ï§Ñ Ïàò ÏûàÏäµÎãàÎã§.

## Ï§ëÏöî Í∑úÏπô
- Î∞òÎìúÏãú ÏúÑ Îç∞Ïù¥ÌÑ∞Ïóê ÏûàÎäî Ï†ïÎ≥¥Îßå ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.
- Ïù¥ Î¶¨Í∑∏ ÌÜµÍ≥ÑÏôÄ Í¥ÄÎ†® ÏóÜÎäî ÏßàÎ¨∏(ÎÇ†Ïî®, ÏùºÎ∞ò ÏÉÅÏãù, Îã§Î•∏ Ïä§Ìè¨Ï∏† Îì±)ÏóêÎäî Ï†ïÏ§ëÌïòÍ≤å "Ï£ÑÏÜ°Ìï©ÎãàÎã§. Ï†ÄÎäî ÎÇòÏù∏Î∏îÎ°úÏª§Ïä§ Î¶¨Í∑∏ ÌÜµÍ≥ÑÏóê ÎåÄÌïú ÏßàÎ¨∏ÏóêÎßå ÎãµÎ≥ÄÌï† Ïàò ÏûàÏäµÎãàÎã§."ÎùºÍ≥† Í±∞Ï†àÌïòÏÑ∏Ïöî.
- ÎãµÎ≥ÄÏùÄ ÌïúÍµ≠Ïñ¥Î°ú ÏπúÏ†àÌïòÍ≥† Í∞ÑÍ≤∞ÌïòÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî.
- Ïà´Ïûê Îç∞Ïù¥ÌÑ∞Î•º Ïù∏Ïö©Ìï† ÎïåÎäî Ï†ïÌôïÌïòÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî.

## ÎãµÎ≥Ä ÌòïÏãù Í∞ÄÏù¥Îìú (Îß§Ïö∞ Ï§ëÏöî!)
ÌôîÎ©¥Ïù¥ Ï¢ÅÏùÑ Ïàò ÏûàÏúºÎãà Í∞ÑÍ≤∞ÌïòÍ≤å ÎãµÎ≥ÄÌïòÏÑ∏Ïöî.

1. **ÏàúÏúÑ/Îû≠ÌÇπ ÏßàÎ¨∏** (ÎìùÏ†ê ÏÉÅÏúÑ NÏúÑ Îì±):
   - ÌÖåÏù¥Î∏îÏùÄ **ÏµúÎåÄ 3~4Í∞ú Ïª¨Îüº**Îßå ÏÇ¨Ïö©
   - Ïª¨ÎüºÎ™ÖÏùÄ ÏßßÍ≤å: ÏàúÏúÑ‚Üí#, ÏÑ†ÏàòÎ™Ö‚ÜíÏÑ†Ïàò, Í∏∞Î°ù‚ÜíÏàòÏπò
   - ÏòàÏãú:
   | # | ÏÑ†Ïàò | ÌåÄ | ÎìùÏ†ê |
   |---|------|----|----|
   | 1 | Í∞ïÏû¨Ìõà | B | 48.6 |
   | 2 | ÏïàÎ≥ëÏõÖ | A | 38.8 |

2. **ÌäπÏ†ï ÏÑ†Ïàò Ï†ïÎ≥¥**:
   - Î¶¨Ïä§Ìä∏ ÌòïÏãù ÏÇ¨Ïö© (ÌÖåÏù¥Î∏î X)
   - ÏòàÏãú:
   **ÍπÄÏ†ïÌò∏** (#32, AÌåÄ)
   - ÎìùÏ†ê: 11.4 / 114
   - Ïñ¥Ïãú: 11.5 / 115
   - Î¶¨Î∞î: 8.5 / 85

3. **ÎπÑÍµê ÏßàÎ¨∏**:
   - 2~3Í∞ú Ìï≠Î™© ÎπÑÍµêÏãú Î¶¨Ïä§Ìä∏
   - ÎßéÏùÄ Ìï≠Î™© ÎπÑÍµêÏãú Í∞ÑÍ≤∞Ìïú ÌÖåÏù¥Î∏î

4. **ÏùºÎ∞ò ÏõêÏπô**:
   - Ïà´ÏûêÎäî ÏÜåÏàòÏ†ê 1ÏûêÎ¶¨ÍπåÏßÄÎßå
   - Î∂àÌïÑÏöîÌïú ÏÑ§Î™Ö ÏÉùÎûµ
   - ÌïµÏã¨Îßå **ÍµµÍ≤å** Í∞ïÏ°∞`;
    }

    // Í∞ÑÎã®Ìïú ÎßàÌÅ¨Îã§Ïö¥ ÌååÏÑú
    function parseMarkdown(text) {
      // ÌÖåÏù¥Î∏î ÌååÏã± (Ïä§ÌÅ¨Î°§ Í∞ÄÎä•Ìïú wrapperÎ°ú Í∞êÏã∏Í∏∞)
      text = text.replace(/\n?\|(.+)\|\n\|[-\s|]+\|\n((?:\|.+\|\n?)+)/g, (match, header, body) => {
        const headers = header.split('|').map(h => h.trim()).filter(h => h);
        const rows = body.trim().split('\n').map(row => 
          row.split('|').map(cell => cell.trim()).filter(cell => cell)
        );
        
        let table = '<div class="table-wrapper"><table><thead><tr>';
        headers.forEach(h => table += `<th>${h}</th>`);
        table += '</tr></thead><tbody>';
        rows.forEach(row => {
          table += '<tr>';
          row.forEach(cell => table += `<td>${cell}</td>`);
          table += '</tr>';
        });
        table += '</tbody></table></div>';
        return table;
      });

      // Î≥ºÎìú Ï≤òÎ¶¨
      text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      
      // Ïù¥ÌÉ§Î¶≠ Ï≤òÎ¶¨
      text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');
      
      // Ïù∏ÎùºÏù∏ ÏΩîÎìú
      text = text.replace(/`(.+?)`/g, '<code>$1</code>');
      
      // Ìó§Îçî Ï≤òÎ¶¨
      text = text.replace(/^#### (.+)$/gm, '<h4>$1</h4>');
      text = text.replace(/^### (.+)$/gm, '<h3>$1</h3>');
      
      // ÏàòÌèâÏÑ†
      text = text.replace(/^---$/gm, '<hr>');
      
      // ÏàúÏÑú ÏûàÎäî Î¶¨Ïä§Ìä∏
      text = text.replace(/^(\d+)\. (.+)$/gm, '<li data-num="$1">$2</li>');
      text = text.replace(/(<li data-num="\d+">.+<\/li>\n?)+/g, (match) => `<ol>${match}</ol>`);
      text = text.replace(/ data-num="\d+"/g, '');
      
      // ÏàúÏÑú ÏóÜÎäî Î¶¨Ïä§Ìä∏
      text = text.replace(/^- (.+)$/gm, '<li>$1</li>');
      text = text.replace(/(<li>.+<\/li>\n?)+/g, (match) => {
        if (!match.includes('<ol>')) return `<ul>${match}</ul>`;
        return match;
      });
      
      // Ï§ÑÎ∞îÍøàÏùÑ <br>Î°ú Î≥ÄÌôò (Î¶¨Ïä§Ìä∏/ÌÖåÏù¥Î∏î/Ìó§Îçî ÌÉúÍ∑∏ Îí§Îäî Ï†úÏô∏)
      text = text.replace(/\n(?!<)/g, '<br>');
      
      // Ïó∞ÏÜçÎêú <br> Ï†ïÎ¶¨
      text = text.replace(/(<br>){3,}/g, '<br><br>');
      
      // ÌÉúÍ∑∏ Îí§ Î∂àÌïÑÏöîÌïú <br> Ï†úÍ±∞
      text = text.replace(/<\/(table|ul|ol|h3|h4|hr)><br>/g, '</$1>');
      text = text.replace(/<br><(table|ul|ol|h3|h4|hr)/g, '<$1');
      
      return text;
    }

    // Î©îÏãúÏßÄ Ï∂îÍ∞Ä
    function addMessage(content, type) {
      const div = document.createElement('div');
      div.className = `message ${type}`;
      
      if (type === 'ai') {
        // AI Î©îÏãúÏßÄÎäî ÎßàÌÅ¨Îã§Ïö¥ ÌååÏã±
        div.innerHTML = parseMarkdown(content);
      } else {
        div.textContent = content;
      }
      
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // ÌÉÄÏù¥Ìïë Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ Ï∂îÍ∞Ä
    function addTypingIndicator() {
      const div = document.createElement('div');
      div.className = 'typing-indicator';
      div.id = 'typingIndicator';
      div.innerHTML = '<span></span><span></span><span></span>';
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // ÌÉÄÏù¥Ìïë Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ Ï†úÍ±∞
    function removeTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) indicator.remove();
    }

    // Î©îÏãúÏßÄ Ï†ÑÏÜ°
    async function sendMessage() {
      const message = chatInput.value.trim();
      if (!message || !genAI) return;

      chatInput.value = '';
      sendBtn.disabled = true;
      addMessage(message, 'user');
      addTypingIndicator();

      try {
        const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
        
        // ÎåÄÌôî ÌûàÏä§ÌÜ†Î¶¨ Íµ¨ÏÑ±
        const historyFormatted = chatHistory.map(h => ({
          role: h.role,
          parts: [{ text: h.content }]
        }));

        const chat = model.startChat({
          history: historyFormatted,
          systemInstruction: {
            parts: [{ text: getSystemPrompt() }]
          }
        });

        const result = await chat.sendMessage(message);
        const response = await result.response;
        const text = response.text();

        // ÌûàÏä§ÌÜ†Î¶¨ ÏóÖÎç∞Ïù¥Ìä∏
        chatHistory.push({ role: 'user', content: message });
        chatHistory.push({ role: 'model', content: text });

        removeTypingIndicator();
        addMessage(text, 'ai');
      } catch (error) {
        console.error('Gemini API Error:', error);
        removeTypingIndicator();
        
        let errorMsg = 'Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
        if (error.message) {
          if (error.message.includes('API_KEY_INVALID') || error.message.includes('API key not valid')) {
            errorMsg = 'API ÌÇ§Í∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§. Ïò¨Î∞îÎ•∏ ÌÇ§Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
          } else if (error.message.includes('PERMISSION_DENIED')) {
            errorMsg = 'API Ï†ëÍ∑º Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. Gemini APIÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
          } else if (error.message.includes('RESOURCE_EXHAUSTED') || error.message.includes('quota')) {
            errorMsg = 'API Ìï†ÎãπÎüâÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.';
          } else if (error.message.includes('fetch') || error.message.includes('network')) {
            errorMsg = 'ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
          } else {
            errorMsg = `Ïò§Î•ò: ${error.message}`;
          }
        }
        addMessage(errorMsg, 'system');
      }

      sendBtn.disabled = false;
    }

    // Ï†ÑÏÜ° Î≤ÑÌäº ÌÅ¥Î¶≠
    sendBtn.addEventListener('click', sendMessage);

    // Enter ÌÇ§Î°ú Ï†ÑÏÜ°
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // ÏãúÏ¶å ÏÑ†ÌÉù Ìï∏Îì§Îü¨
    document.querySelectorAll('#seasonSelector .toggle-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        switchSeason(btn.dataset.season);
      });
    });

    // Ïï± Ï¥àÍ∏∞Ìôî (ÎπÑÎèôÍ∏∞)
    async function initApp() {
      try {
        // ÏãúÏ¶å Îç∞Ïù¥ÌÑ∞ÏôÄ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Î≥ëÎ†¨ Î°úÎî©
        const [seasons, metadata] = await Promise.all([
          loadAllSeasons(),
          loadAllMetadata()
        ]);
        seasonsData = seasons;
        metadataCache = metadata;
        leagueData = seasonsData[currentSeason];
        initGemini();
        updateHeader();
        renderTable();
        updateSortHeaders();
      } catch (error) {
        console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®:', error);
        document.querySelector('.container').innerHTML = `
          <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
            <h2>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</h2>
            <p>ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ® Ìï¥Ï£ºÏÑ∏Ïöî.</p>
          </div>
        `;
      }
    }

    initApp();

    // Í≥†Ï†ï Ìó§Îçî Í∏∞Îä•
    const tableWrapper = document.querySelector('.table-wrapper');
    const tableScroll = document.querySelector('.table-scroll');
    const originalThead = document.querySelector('table thead');
    let fixedHeaderContainer = null;
    let fixedHeaderOverlay = null;

    function createFixedHeader() {
      if (fixedHeaderContainer) return;

      // ÏÉÅÎã® Ïò§Î≤ÑÎ†àÏù¥ ÏÉùÏÑ±
      fixedHeaderOverlay = document.createElement('div');
      fixedHeaderOverlay.className = 'fixed-header-overlay';
      document.body.appendChild(fixedHeaderOverlay);

      // Í≥†Ï†ï Ìó§Îçî ÏÉùÏÑ±
      fixedHeaderContainer = document.createElement('div');
      fixedHeaderContainer.className = 'fixed-header';
      fixedHeaderContainer.style.display = 'none';

      const table = document.createElement('table');
      table.innerHTML = originalThead.outerHTML;
      fixedHeaderContainer.appendChild(table);

      document.body.appendChild(fixedHeaderContainer);

      // Í≥†Ï†ï Ìó§ÎçîÏùò Ï†ïÎ†¨ Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞
      fixedHeaderContainer.querySelectorAll('th[data-sort]').forEach(th => {
        th.addEventListener('click', () => {
          const field = th.dataset.sort;
          if (currentSort.field === field) {
            currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
          } else {
            currentSort.field = field;
            currentSort.order = 'desc';
          }
          updateSortHeaders();
          updateFixedHeaderSort();
          renderTable();
        });
      });
    }

    function updateFixedHeaderSort() {
      if (!fixedHeaderContainer) return;
      fixedHeaderContainer.querySelectorAll('th').forEach(th => {
        th.classList.remove('sorted', 'asc', 'desc');
        if (th.dataset.sort === currentSort.field) {
          th.classList.add('sorted', currentSort.order);
        }
      });
    }

    function updateFixedHeader() {
      if (!fixedHeaderContainer) return;

      const wrapperRect = tableWrapper.getBoundingClientRect();
      const theadRect = originalThead.getBoundingClientRect();
      const tableRect = tableScroll.querySelector('table').getBoundingClientRect();

      // theadÍ∞Ä ÌôîÎ©¥ ÏÉÅÎã®ÏùÑ Î≤óÏñ¥ÎÇ¨Í≥†, ÌÖåÏù¥Î∏îÏù¥ ÏïÑÏßÅ ÌôîÎ©¥Ïóê ÏûàÏùÑ Îïå
      const shouldFix = theadRect.top <= 0 && wrapperRect.bottom > theadRect.height;

      if (shouldFix) {
        // Ïª®ÌÖåÏù¥ÎÑà Ìå®Îî© ÎèôÏ†Å Í≥ÑÏÇ∞ (Î∞òÏùëÌòï ÏßÄÏõê)
        const containerPadding = window.innerWidth <= 768 ? 16 : 24;

        // Í≥†Ï†ï Ìó§Îçî ÌëúÏãú
        fixedHeaderContainer.style.display = 'block';
        fixedHeaderContainer.style.top = containerPadding + 'px';
        fixedHeaderContainer.style.left = wrapperRect.left + 'px';
        fixedHeaderContainer.style.width = wrapperRect.width + 'px';

        // Ïò§Î≤ÑÎ†àÏù¥ ÌëúÏãú (Í≥†Ï†ï Ìó§Îçî Îí§ÍπåÏßÄ ÎçÆÎèÑÎ°ù)
        const fixedHeaderHeight = fixedHeaderContainer.offsetHeight;
        fixedHeaderOverlay.style.display = 'block';
        fixedHeaderOverlay.style.left = wrapperRect.left + 'px';
        fixedHeaderOverlay.style.width = wrapperRect.width + 'px';
        fixedHeaderOverlay.style.height = (containerPadding + fixedHeaderHeight) + 'px';

        // Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ ÎèôÍ∏∞Ìôî
        const scrollLeft = tableScroll.scrollLeft;
        fixedHeaderContainer.querySelector('table').style.transform = `translateX(-${scrollLeft}px)`;
        fixedHeaderContainer.querySelector('table').style.width = tableRect.width + 'px';

        // Ïª¨Îüº ÎÑàÎπÑ ÎèôÍ∏∞Ìôî
        const originalThs = originalThead.querySelectorAll('th');
        const fixedThs = fixedHeaderContainer.querySelectorAll('th');
        originalThs.forEach((th, i) => {
          fixedThs[i].style.width = th.offsetWidth + 'px';
          fixedThs[i].style.minWidth = th.offsetWidth + 'px';
        });
      } else {
        fixedHeaderContainer.style.display = 'none';
        fixedHeaderOverlay.style.display = 'none';
      }
    }

    // Ï¥àÍ∏∞Ìôî
    createFixedHeader();
    updateFixedHeaderSort();

    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
    window.addEventListener('scroll', updateFixedHeader);
    window.addEventListener('resize', updateFixedHeader);
    tableScroll.addEventListener('scroll', updateFixedHeader);

    // MutationObserverÎ°ú ÌÖåÏù¥Î∏î Î≥ÄÍ≤Ω Í∞êÏßÄ
    const observer = new MutationObserver(() => {
      updateFixedHeader();
      updateFixedHeaderSort();
    });
    observer.observe(originalThead, { childList: true, subtree: true, attributes: true });
  </script>
</body>
</html>

